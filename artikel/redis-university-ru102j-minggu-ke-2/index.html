<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" class="h-full" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D,%22class%22:%7B%22ssr%22:%22h-full%22%7D%7D">
  <head>
    <title>Redis University RU102J - Minggu Ke-2 </title><meta name="gridsome:hash" content="1edf71e944044bc70c25b692f010f187723da530"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="theme-color" content="#1a202c"><meta data-vue-tag="ssr" data-key="description" name="description" content="Catatan kelas Redis University RU102 minggu ke-2"><meta data-vue-tag="ssr" property="og:type" content="article"><meta data-vue-tag="ssr" property="og:title" content="Redis University RU102J - Minggu Ke-2"><meta data-vue-tag="ssr" property="og:description" content="Catatan kelas Redis University RU102 minggu ke-2"><meta data-vue-tag="ssr" property="og:url" content="https://www.emsifa.com/artikel/redis-university-ru102j-minggu-ke-2/"><meta data-vue-tag="ssr" property="article:published_time" content="undefined"><meta data-vue-tag="ssr" property="og:image" content="https://www.emsifa.com/images/posts/ru102j-w2-cover.png"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:title" content="Redis University RU102J - Minggu Ke-2"><meta data-vue-tag="ssr" name="twitter:description" content="Catatan kelas Redis University RU102 minggu ke-2"><meta data-vue-tag="ssr" name="twitter:site" content="@cossssmin"><meta data-vue-tag="ssr" name="twitter:creator" content="@cossssmin"><meta data-vue-tag="ssr" name="twitter:image" content="/images/posts/ru102j-w2-cover.png"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.74da076e48a2b4ada66099d4f12215f4.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.74da076e48a2b4ada66099d4f12215f4.png"><link rel="preload" href="/assets/css/9.styles.f932b0e9.css" as="style"><link rel="preload" href="/assets/js/app.7018cf29.js" as="script"><link rel="preload" href="/assets/js/page--src-templates-post-vue.c0e9f36f.js" as="script"><link rel="prefetch" href="/assets/js/11.0f98a1ef.js"><link rel="prefetch" href="/assets/js/page--src-pages-404-vue.0ce9f9ea.js"><link rel="prefetch" href="/assets/js/page--src-pages-artikel-vue.c5d0d9d8.js"><link rel="prefetch" href="/assets/js/page--src-pages-index-vue.026ad315.js"><link rel="prefetch" href="/assets/js/page--src-pages-open-sources-vue.a82ed9ec.js"><link rel="prefetch" href="/assets/js/page--src-templates-author-vue.8270f084.js"><link rel="prefetch" href="/assets/js/page--src-templates-tag-vue.77d06a93.js"><link rel="prefetch" href="/assets/js/vendors~page--src-pages-artikel-vue~page--src-pages-index-vue~page--src-pages-open-sources-vue~page-~f457dff2.6d23a2bb.js"><link rel="prefetch" href="/assets/js/vendors~page--src-templates-post-vue.8b322f2d.js"><link rel="stylesheet" href="/assets/css/9.styles.f932b0e9.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body class="antialiased" data-vue-tag="%7B%22class%22:%7B%22ssr%22:%22antialiased%22%7D%7D">
    <div data-server-rendered="true" id="app" class="min-h-screen light"><header class="select-none mb-5 shadow-lg border-gray-200" data-v-1b58b763><div class="container m-auto max-w-3xl px-5 md:px-0 py-5" data-v-1b58b763><div class="flex" data-v-1b58b763><div class="w-10/12" data-v-1b58b763><a href="/" class="text-black w-full inline-block active" data-v-1b58b763><div class="flex" data-v-1b58b763><div class="w-auto" data-v-1b58b763><img src="/images/logo.svg" alt="Logo" class="inline" data-v-1b58b763></div><div class="w-auto ml-3 pt-2" data-v-1b58b763><h1 class="text-normal font-semibold text-gray-700" data-v-1b58b763>
                Webnya Muhammad Syifa
              </h1><h2 class="text-sm text-gray-700 text-gray-700" data-v-1b58b763>
                Ini halaman artikel
              </h2></div></div></a></div><div class="w-2/12 text-right pt-3" data-v-1b58b763><button title="Gelapin" class="
            p-2
            rounded-full
            bg-transparent
            transition-all
            focus:outline-none
           hover:bg-yellow-200" data-v-1b58b763><img src="/images/sun.svg" alt="Sun" style="width:30px;height:30px;" data-v-1b58b763><!----></button></div></div></div></header><main><header><div class="container m-auto max-w-3xl px-5 md:px-0"><div class="mx-auto pb-5 border-b border-gray-200 text-gray-700"><img alt="Redis University RU102J - Minggu Ke-2" src="/images/posts/ru102j-w2-cover.png" class="rounded-xl shadow-xl g-image"><h1 class="text-3xl sm:text-3xl leading-tight font-sans font-semibold mb-3 mt-5">
        Redis University RU102J - Minggu Ke-2
      </h1><p class="text-sm"><time datetime="2019-08-18 09:00:00" class="capitalize">18 Agustus 2019</time></p><p class="text-xs mt-2 uppercase"></p><div class="tags mt-5"><a href="/tag/Redis%20University/" class="
          inline-block
          font-sans
          font-semibold
          text-xs
          sm:text-sm
          px-2
          py-1
          mr-2
          mb-2
          rounded
          transition-color
          transition-bg
         text-gray-700 bg-gray-200 hover:text-white hover:bg-gray-700">
          Redis University
        </a><a href="/tag/Course/" class="
          inline-block
          font-sans
          font-semibold
          text-xs
          sm:text-sm
          px-2
          py-1
          mr-2
          mb-2
          rounded
          transition-color
          transition-bg
         text-gray-700 bg-gray-200 hover:text-white hover:bg-gray-700">
          Course
        </a><a href="/tag/RU102J/" class="
          inline-block
          font-sans
          font-semibold
          text-xs
          sm:text-sm
          px-2
          py-1
          mr-2
          mb-2
          rounded
          transition-color
          transition-bg
         text-gray-700 bg-gray-200 hover:text-white hover:bg-gray-700">
          RU102J
        </a></div></div></div></header><div class="container m-auto max-w-3xl px-5 md:px-0"><article class="pt-5 border-grey-200"><div class="markdown text-lg leading-normal text-gray-700 pb-10"><p>Ini adalah catatan minggu ke-2 saya di kelas RU102J-nya Redis University.
Jika pada minggu pertama hanya sebatas setup java environment, java redis client dan perkenalan DAO pattern,
pada minggu ini kita mulai membuat aplikasi RediSolar.</p>
<p>Spesifiknya, minggu ini topik pembahasannya adalah:</p>
<ol>
<li>Pengenalan Data Model</li>
<li>Metrics with Sorted Sets</li>
<li>Making Lua Script</li>
<li>Pipelining with Jedis</li>
<li>Transactions with Jedis</li>
</ol>
<h2 id="1-pengenalan-data-model"><a href="#1-pengenalan-data-model" aria-hidden="true"><span class="icon icon-link"></span></a>1. Pengenalan Data Model</h2>
<p>Data model ini sebetulnya sudah sedikit disinggung pada minggu pertama pada diagram DAO.
Cuma disini dicontohkan membuat data model untuk MeterReading (meteran).</p>
<p>Jadi untuk membuat aplikasi RediSolar ini, kita membutuhkan data model class MeterReading dengan
properti seperti dibawah ini:</p>
<div class='code-container'><pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #C792EA">public</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">class</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">MeterReading</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #C792EA">private</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">Long</span><span style="color: #A6ACCD"> siteId</span><span style="color: #89DDFF">;</span><span style="color: #A6ACCD">            </span><span style="color: #676E95">// ID lokasi (rumah)</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #C792EA">private</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">ZonedDateTime</span><span style="color: #A6ACCD"> dateTime</span><span style="color: #89DDFF">;</span><span style="color: #A6ACCD"> </span><span style="color: #676E95">// waktu</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #C792EA">private</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">Double</span><span style="color: #A6ACCD"> whUsed</span><span style="color: #89DDFF">;</span><span style="color: #A6ACCD">          </span><span style="color: #676E95">// daya digunakan</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #C792EA">private</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">Double</span><span style="color: #A6ACCD"> whGenerated</span><span style="color: #89DDFF">;</span><span style="color: #A6ACCD">     </span><span style="color: #676E95">// daya digenerate</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #C792EA">private</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">Double</span><span style="color: #A6ACCD"> tempC</span><span style="color: #89DDFF">;</span><span style="color: #A6ACCD">           </span><span style="color: #676E95">// suhu dalam celcius</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div>
<h2 id="2-metrics-with-sorted-sets"><a href="#2-metrics-with-sorted-sets" aria-hidden="true"><span class="icon icon-link"></span></a>2. Metrics with Sorted Sets</h2>
<p>Kemudian untuk menyimpan metric, struktur data yang digunakan adalah sorted sets dengan
format key dan value seperti dibawah ini:</p>
<p>Format key:</p>
<div class='code-container'><pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #A6ACCD">metrics:wHg:2020-01-01:1</span></span></code></pre></div>
<p>Dimana:</p>
<ul>
<li><code>metrics</code>: prefix</li>
<li><code>wHg</code>: unit (satuan)</li>
<li><code>2020-01-01</code>: tanggal</li>
<li><code>1</code>: site ID</li>
</ul>
<p>Sedangkan untuk struktur sorted setnya adalah sebagai berikut:</p>
<ul>
<li>score: menit</li>
<li>value: nilai:menit</li>
</ul>
<p>Contoh, perintah <code>ZADD</code> dibawah ini maksudnya adalah:</p>
<div class='code-container'><pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #A6ACCD">ZADD metrics:wHg:2020-01-01:1 30 18.5:30</span></span></code></pre></div>
<ul>
<li>Unit: wHg (watt hours generated)</li>
<li>Tanggal: 2020-01-01</li>
<li>Site ID: 1</li>
<li>Menit: 30</li>
<li>Nilai: 18.5</li>
</ul>
<p>Struktur seperti diatas digunakan karena:</p>
<ol>
<li>Pengukuran (metrics) akan secara otomatis disortir.</li>
<li>Efisien untuk di fetch: O((log n) + m).</li>
<li>Efisien untuk insert: O(log n).</li>
<li>Hemat memori.</li>
</ol>
<h2 id="3-making-lua-script"><a href="#3-making-lua-script" aria-hidden="true"><span class="icon icon-link"></span></a>3. Making Lua Script</h2>
<p>Topik pembahasan selanjutnya adalah tentang tata cara menjalankan script Lua pada Java untuk melakukan atomic transaction di Redis. Kalau di MySQL atau RDBMS lain mungkin kalian familiar dengan istilah stored procedure, nah si Lua disini perannya seperti itu.</p>
<p>Sebagai contoh, kita ingin membuat script untuk mengupdate sebuah key, hanya jika key belum ada, atau nilai yang baru lebih rendah dari nilainya saat ini.</p>
<p>Pertama kita harus persiapkan class <code>UpdateIfLowerScript</code> sebagai berikut (pahami sendiri):</p>
<div class='code-container'><pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #C792EA">public</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">class</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">UpdateIfLowerScript</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>

<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #C792EA">private</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">final</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">Jedis</span><span style="color: #A6ACCD"> jedis</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #C792EA">private</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">final</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">String</span><span style="color: #A6ACCD"> sha</span><span style="color: #89DDFF">;</span></span>

<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #C792EA">private</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">final</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">static</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">String</span><span style="color: #A6ACCD"> script </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> </span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">local key = KEYS[1]</span><span style="color: #89DDFF">&quot;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">+</span><span style="color: #A6ACCD">  </span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">local new = ARGS[1]</span><span style="color: #89DDFF">&quot;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">+</span><span style="color: #A6ACCD">  </span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">local current = redis.call(&#39;GET&#39;, key)</span><span style="color: #89DDFF">&quot;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">+</span><span style="color: #A6ACCD">  </span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">if (current == false or (tonumber(new) &lt; tonumber(current))) then</span><span style="color: #89DDFF">&quot;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">+</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">    redis.call(&#39;SET&#39;, key, new)</span><span style="color: #89DDFF">&quot;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">+</span><span style="color: #A6ACCD"> </span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">    return 1</span><span style="color: #89DDFF">&quot;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">+</span><span style="color: #A6ACCD">  </span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">else</span><span style="color: #89DDFF">&quot;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">+</span><span style="color: #A6ACCD"> </span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">    return 0</span><span style="color: #89DDFF">&quot;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">+</span><span style="color: #A6ACCD"> </span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">end</span><span style="color: #89DDFF">&quot;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">+</span></span>

<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #C792EA">public</span><span style="color: #A6ACCD"> </span><span style="color: #82AAFF">UpdateIfLowerScript</span><span style="color: #89DDFF">(</span><span style="color: #C792EA">Jedis</span><span style="color: #A6ACCD"> jedis</span><span style="color: #89DDFF">)</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">this.</span><span style="color: #A6ACCD">jedis </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> jedis</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">this.</span><span style="color: #A6ACCD">sha </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> jedis</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">scriptLoad</span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">script</span><span style="color: #89DDFF">);</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #89DDFF">}</span></span>

<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #C792EA">public</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">boolean</span><span style="color: #A6ACCD"> </span><span style="color: #82AAFF">updateIfLower</span><span style="color: #89DDFF">(</span><span style="color: #C792EA">String</span><span style="color: #A6ACCD"> key</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">Integer</span><span style="color: #A6ACCD"> newValue</span><span style="color: #89DDFF">)</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #C792EA">List</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">String</span><span style="color: #89DDFF">&gt;</span><span style="color: #A6ACCD"> keys </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> Collections</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">singletonList</span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">key</span><span style="color: #89DDFF">);</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #C792EA">List</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">String</span><span style="color: #89DDFF">&gt;</span><span style="color: #A6ACCD"> args </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> Collections</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">singletonList</span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">newValue</span><span style="color: #89DDFF">);</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #C792EA">Object</span><span style="color: #A6ACCD"> response </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> jedis</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">evalsha</span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">sha</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> keys</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> args</span><span style="color: #89DDFF">);</span></span>

<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">return</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">Long</span><span style="color: #89DDFF">)</span><span style="color: #A6ACCD"> response </span><span style="color: #89DDFF">==</span><span style="color: #A6ACCD"> </span><span style="color: #F78C6C">1</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #A6ACCD">}</span></span></code></pre></div>
<p>Selanjutnya, cara panggilnya ya tinggal buat aja instancenya, lalu panggil methodnya seperti dibawah ini:</p>
<div class='code-container'><pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #C792EA">UpdateIfLowerScript</span><span style="color: #A6ACCD"> script </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">new</span><span style="color: #A6ACCD"> </span><span style="color: #82AAFF">UpdateIfLowerScript</span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">jedis</span><span style="color: #89DDFF">);</span></span>
<span class="line"><span style="color: #C792EA">boolean</span><span style="color: #A6ACCD"> result </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> script</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">updateIfLower</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">keynya</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #F78C6C">100</span><span style="color: #89DDFF">);</span></span></code></pre></div>
<p>Oia katanya biasanya bakal banyak script Lua di project Java kita, jadi supaya rapih sebisa mungkin dibuat 1 script 1 class, dan disimpan dalam 1 folder yang sama.</p>
<p>Dan kenapa nggak pakai script Java aja langsung? seperti yang disinggung diatas, script Lua ini bersifat atomic.
Yang artinya script akan membloking eksekusi dari Redis Client lain sampai script Lua ini selesai dijalankan.
Jadi tidak ada transaksi dari Redis Client lain yang terselip ditengah-tengah Lua script ini.</p>
<h2 id="4-pipelining-with-jedis"><a href="#4-pipelining-with-jedis" aria-hidden="true"><span class="icon icon-link"></span></a>4. Pipelining with Jedis</h2>
<p>Pembahasan selanjutnya adalah tentang penggunaan pipeline. Pada DBMS lain, istilah yang mirip-mirip dengan pipeline adalah transaction. Dengan pipeline kita bisa mengirim banyak perintah sekaligus sehingga Redis Client nggak perlu bolak-balik request-response ke Redis Server.</p>
<p>Bayangin kamu ke warung mau beli mie instan dan saos. Jika kamu adalah Redis Client, secara default kamu akan bolak-balik, beli mie instan dulu, sampai rumah, kemudian balik lagi untuk beli saos, terus balik lagi ke rumah. Dengan pipeline, kamu (si Redis Client) akan membeli mie instan dan saos secara bersamaan. Efeknya? tentu saja mempercepat waktu eksekusi dan latency.</p>
<p>Di Jedis sendiri, cara menggunakan pipeline adalah sebagai berikut:</p>
<div class='code-container'><pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #C792EA">Long</span><span style="color: #A6ACCD"> siteId </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> </span><span style="color: #F78C6C">1L</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #C792EA">Pipeline</span><span style="color: #A6ACCD"> p </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> jedis</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">pipelined</span><span style="color: #89DDFF">();</span><span style="color: #A6ACCD">  </span><span style="color: #676E95">// inisiasi pipeline</span></span>

<span class="line"><span style="color: #C792EA">Response</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">Long</span><span style="color: #89DDFF">&gt;</span><span style="color: #A6ACCD"> hsetResponse </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> p</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">hset</span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">statusKey</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">available</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">true</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span><span style="color: #A6ACCD"> </span><span style="color: #676E95">// push hset command to pipeline</span></span>
<span class="line"><span style="color: #C792EA">Response</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">Long</span><span style="color: #89DDFF">&gt;</span><span style="color: #A6ACCD"> expireResponse </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> p</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">expire</span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">statusKey</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #F78C6C">1000</span><span style="color: #89DDFF">);</span><span style="color: #A6ACCD"> </span><span style="color: #676E95">// push expire command to pipeline</span></span>
<span class="line"><span style="color: #C792EA">Response</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">Long</span><span style="color: #89DDFF">&gt;</span><span style="color: #A6ACCD"> saddResponse </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> p</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">sadd</span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">availableKey</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> String</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">valueOf</span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">siteId</span><span style="color: #89DDFF">));</span><span style="color: #A6ACCD"> </span><span style="color: #676E95">// push sadd command to pipeline</span></span>

<span class="line"><span style="color: #A6ACCD">p</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">sync</span><span style="color: #89DDFF">();</span><span style="color: #A6ACCD"> </span><span style="color: #676E95">// run pipeline to execute all commands</span></span>

<span class="line"><span style="color: #C792EA">Long</span><span style="color: #A6ACCD"> hsetResult </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> hsetResponse</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">get</span><span style="color: #89DDFF">();</span><span style="color: #A6ACCD"> </span><span style="color: #676E95">// get result from p.hset</span></span>
<span class="line"><span style="color: #C792EA">Long</span><span style="color: #A6ACCD"> expireResult </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> expireResponse</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">get</span><span style="color: #89DDFF">();</span><span style="color: #A6ACCD"> </span><span style="color: #676E95">// get result from p.expire</span></span>
<span class="line"><span style="color: #C792EA">Long</span><span style="color: #A6ACCD"> saddResult </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> saddResponse</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">get</span><span style="color: #89DDFF">();</span><span style="color: #A6ACCD"> </span><span style="color: #676E95">// get result from p.sadd</span></span></code></pre></div>
<p>Dengan pipeine seperti diatas, 3 perintah akan dikirim ke Redis Server secara bersamaan.
Hanya saja, sifat pipeline tidak seperti transaksi, dimana jika salah satunya gagal, Redis tidak akan merollback command sebelumnya. Dan juga saat pipeline berjalan, katakanlah kita mengirim 100 perintah, kemudian pada perintah ke 70 ada Redis Client mengirim perintah juga, maka perintah dari Redis Client lain akan berjalan ditengah-tengah pipeline.</p>
<h2 id="5-transactions-with-jedis"><a href="#5-transactions-with-jedis" aria-hidden="true"><span class="icon icon-link"></span></a>5. Transactions with Jedis</h2>
<p>Pembahasan selanjutnya adalah tentang transaction. Transaction di Redis ini mirip-mirip dengan pipeline,
hanya saja transaction mendukung atomic transaction. Jika kita menjalankan 5 perintah menggunakan transaction,
maka jika ada Redis Client lain mengirim perintah ke Redis Server yang sama, maka Redis Client lain tersebut harus menunggu sampai 5 perintah kita selesai dijalankan.</p>
<p>Contoh menerapkan transaction menggunakan Jedis:</p>
<div class='code-container'><pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #C792EA">Long</span><span style="color: #A6ACCD"> siteId </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> </span><span style="color: #F78C6C">1L</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #C792EA">Transaction</span><span style="color: #A6ACCD"> t </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> jedis</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">multi</span><span style="color: #89DDFF">();</span><span style="color: #A6ACCD">  </span><span style="color: #676E95">// inisiasi transaction</span></span>

<span class="line"><span style="color: #C792EA">Response</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">Long</span><span style="color: #89DDFF">&gt;</span><span style="color: #A6ACCD"> hsetResponse </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> t</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">hset</span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">statusKey</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">available</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">true</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span><span style="color: #A6ACCD"> </span><span style="color: #676E95">// push hset command to transaction</span></span>
<span class="line"><span style="color: #C792EA">Response</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">Long</span><span style="color: #89DDFF">&gt;</span><span style="color: #A6ACCD"> expireResponse </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> t</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">expire</span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">statusKey</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #F78C6C">1000</span><span style="color: #89DDFF">);</span><span style="color: #A6ACCD"> </span><span style="color: #676E95">// push expire command to transaction</span></span>
<span class="line"><span style="color: #C792EA">Response</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">Long</span><span style="color: #89DDFF">&gt;</span><span style="color: #A6ACCD"> saddResponse </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> t</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">sadd</span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">availableKey</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> String</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">valueOf</span><span style="color: #89DDFF">(</span><span style="color: #A6ACCD">siteId</span><span style="color: #89DDFF">));</span><span style="color: #A6ACCD"> </span><span style="color: #676E95">// push sadd command to transaction</span></span>

<span class="line"><span style="color: #A6ACCD">t</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">exec</span><span style="color: #89DDFF">();</span><span style="color: #A6ACCD"> </span><span style="color: #676E95">// run transaction to execute all commands</span></span>

<span class="line"><span style="color: #C792EA">Long</span><span style="color: #A6ACCD"> hsetResult </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> hsetResponse</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">get</span><span style="color: #89DDFF">();</span><span style="color: #A6ACCD"> </span><span style="color: #676E95">// get result from t.hset</span></span>
<span class="line"><span style="color: #C792EA">Long</span><span style="color: #A6ACCD"> expireResult </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> expireResponse</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">get</span><span style="color: #89DDFF">();</span><span style="color: #A6ACCD"> </span><span style="color: #676E95">// get result from t.expire</span></span>
<span class="line"><span style="color: #C792EA">Long</span><span style="color: #A6ACCD"> saddResult </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> saddResponse</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">get</span><span style="color: #89DDFF">();</span><span style="color: #A6ACCD"> </span><span style="color: #676E95">// get result from t.sadd</span></span></code></pre></div>
<h2 id="kapan-harus-menggunakan-lua-script-pipeline-dan-transaction"><a href="#kapan-harus-menggunakan-lua-script-pipeline-dan-transaction" aria-hidden="true"><span class="icon icon-link"></span></a>Kapan Harus Menggunakan Lua Script, Pipeline, dan Transaction?</h2>
<ol>
<li>Jika kamu membolehkan ada query dari client lain berjalan di tengah-tengah multiple query, gunakan Pipeline.</li>
<li>Jika kamu tidak ingin ada query dari client lain berjalan di tengah-tengah multiple query, gunakan Transaction.</li>
<li>Jika kamu ingin menggunakan conditional statement di tengah-tengah eksekusi multiple query, gunakan Lua Script.</li>
</ol>
<hr>
<p>Begitulah topik pembahasan di kelas RU102J di minggu ke-2. Yaudah, sampai jumpa lagi di minggu selanjutnya.</p>
</div></article></div><section class="mb-10 py-16 bg-gray-200 text-gray-700"><div class="container m-auto max-w-3xl px-5 md:px-0"><div class="flex"><div class="w-10/12 mx-auto"><h4 class="text-2xl font-semibold mb-4 -mt-4">Suka artikel ini?</h4><p class="mb-8">
          Saya biasanya share artikel-artikel terbaru via
          <strong class="text-gray-700">facebook</strong> atau <strong class="text-gray-700">fanpage foobarology</strong> saya.
          Kalau mau dapat updatenya, di add friend/like/follow aja link-link dibawah ini 😃
        </p><a target="_blank" rel="noopener" href="https://www.facebook.com/em.sifa" class="px-4 py-2 text-lg text-white bg-gray-600 hover:bg-blue-500 rounded">
          Facebook
        </a><a target="_blank" rel="noopener" href="https://www.facebook.com/foobarology" class="ml-3 px-4 py-2 text-lg text-white bg-gray-600 hover:bg-blue-500 rounded">
          Foobarology
        </a></div></div></div></section><footer class="text-gray-700 text-sm leading-normal flex flex-wrap justify-between mx-auto max-w-3xl px-6 sm:px-12 pb-8 sm:pb-10"><div class="w-full sm:w-1/2 mb-4 sm:mb-0 text-gray-700"><p>© 2019</p></div><div class="w-full sm:w-1/2"><nav><ul class="flex sm:justify-end -mx-2"><li class="px-2"><a href="/" class="text-gray-700 border-b border-transparent hover:border-gray-400 transition-border-color active">Home</a></li><li class="px-2"><a href="/sitemap.xml" class="text-gray-700 border-b border-transparent hover:border-gray-400 transition-border-color">Sitemap</a></li><li class="px-2"><a href="/feed.xml" class="text-gray-700 border-b border-transparent hover:border-gray-400 transition-border-color">RSS Feed</a></li></ul></nav></div></footer></main></div>
    <script src="/assets/js/app.7018cf29.js" defer></script><script src="/assets/js/page--src-templates-post-vue.c0e9f36f.js" defer></script>
  </body>
</html>
