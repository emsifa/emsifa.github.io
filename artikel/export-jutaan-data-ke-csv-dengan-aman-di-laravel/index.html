<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" class="h-full" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D,%22class%22:%7B%22ssr%22:%22h-full%22%7D%7D">
  <head>
    <title>Export Jutaan Data ke CSV dengan Aman di Laravel </title><meta name="gridsome:hash" content="1edf71e944044bc70c25b692f010f187723da530"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="theme-color" content="#1a202c"><meta data-vue-tag="ssr" data-key="description" name="description" content="Bagaimana memanfaatkan generator dan streaming CSV untuk export jutaan data secara aman."><meta data-vue-tag="ssr" property="og:type" content="article"><meta data-vue-tag="ssr" property="og:title" content="Export Jutaan Data ke CSV dengan Aman di Laravel"><meta data-vue-tag="ssr" property="og:description" content="Bagaimana memanfaatkan generator dan streaming CSV untuk export jutaan data secara aman."><meta data-vue-tag="ssr" property="og:url" content="https://www.emsifa.com/artikel/export-jutaan-data-ke-csv-dengan-aman-di-laravel/"><meta data-vue-tag="ssr" property="article:published_time" content="undefined"><meta data-vue-tag="ssr" property="og:image" content="https://www.emsifa.com/images/posts/export-jutaan-data-ke-csv-dengan-aman-di-laravel.png"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:title" content="Export Jutaan Data ke CSV dengan Aman di Laravel"><meta data-vue-tag="ssr" name="twitter:description" content="Bagaimana memanfaatkan generator dan streaming CSV untuk export jutaan data secara aman."><meta data-vue-tag="ssr" name="twitter:site" content="@cossssmin"><meta data-vue-tag="ssr" name="twitter:creator" content="@cossssmin"><meta data-vue-tag="ssr" name="twitter:image" content="/images/posts/export-jutaan-data-ke-csv-dengan-aman-di-laravel.png"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.74da076e48a2b4ada66099d4f12215f4.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.74da076e48a2b4ada66099d4f12215f4.png"><link rel="preload" href="/assets/css/9.styles.f932b0e9.css" as="style"><link rel="preload" href="/assets/js/app.7018cf29.js" as="script"><link rel="preload" href="/assets/js/page--src-templates-post-vue.c0e9f36f.js" as="script"><link rel="prefetch" href="/assets/js/11.0f98a1ef.js"><link rel="prefetch" href="/assets/js/page--src-pages-404-vue.0ce9f9ea.js"><link rel="prefetch" href="/assets/js/page--src-pages-artikel-vue.c5d0d9d8.js"><link rel="prefetch" href="/assets/js/page--src-pages-index-vue.026ad315.js"><link rel="prefetch" href="/assets/js/page--src-pages-open-sources-vue.a82ed9ec.js"><link rel="prefetch" href="/assets/js/page--src-templates-author-vue.8270f084.js"><link rel="prefetch" href="/assets/js/page--src-templates-tag-vue.77d06a93.js"><link rel="prefetch" href="/assets/js/vendors~page--src-pages-artikel-vue~page--src-pages-index-vue~page--src-pages-open-sources-vue~page-~f457dff2.6d23a2bb.js"><link rel="prefetch" href="/assets/js/vendors~page--src-templates-post-vue.8b322f2d.js"><link rel="stylesheet" href="/assets/css/9.styles.f932b0e9.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body class="antialiased" data-vue-tag="%7B%22class%22:%7B%22ssr%22:%22antialiased%22%7D%7D">
    <div data-server-rendered="true" id="app" class="min-h-screen light"><header class="select-none mb-5 shadow-lg border-gray-200" data-v-1b58b763><div class="container m-auto max-w-3xl px-5 md:px-0 py-5" data-v-1b58b763><div class="flex" data-v-1b58b763><div class="w-10/12" data-v-1b58b763><a href="/" class="text-black w-full inline-block active" data-v-1b58b763><div class="flex" data-v-1b58b763><div class="w-auto" data-v-1b58b763><img src="/images/logo.svg" alt="Logo" class="inline" data-v-1b58b763></div><div class="w-auto ml-3 pt-2" data-v-1b58b763><h1 class="text-normal font-semibold text-gray-700" data-v-1b58b763>
                Webnya Muhammad Syifa
              </h1><h2 class="text-sm text-gray-700 text-gray-700" data-v-1b58b763>
                Ini halaman artikel
              </h2></div></div></a></div><div class="w-2/12 text-right pt-3" data-v-1b58b763><button title="Gelapin" class="
            p-2
            rounded-full
            bg-transparent
            transition-all
            focus:outline-none
           hover:bg-yellow-200" data-v-1b58b763><img src="/images/sun.svg" alt="Sun" style="width:30px;height:30px;" data-v-1b58b763><!----></button></div></div></div></header><main><header><div class="container m-auto max-w-3xl px-5 md:px-0"><div class="mx-auto pb-5 border-b border-gray-200 text-gray-700"><img alt="Export Jutaan Data ke CSV dengan Aman di Laravel" src="/images/posts/export-jutaan-data-ke-csv-dengan-aman-di-laravel.png" class="rounded-xl shadow-xl g-image"><h1 class="text-3xl sm:text-3xl leading-tight font-sans font-semibold mb-3 mt-5">
        Export Jutaan Data ke CSV dengan Aman di Laravel
      </h1><p class="text-sm"><time datetime="2019-11-08 11:00:00" class="capitalize">08 November 2019</time></p><p class="text-xs mt-2 uppercase"></p><div class="tags mt-5"><a href="/tag/Laravel/" class="
          inline-block
          font-sans
          font-semibold
          text-xs
          sm:text-sm
          px-2
          py-1
          mr-2
          mb-2
          rounded
          transition-color
          transition-bg
         text-gray-700 bg-gray-200 hover:text-white hover:bg-gray-700">
          Laravel
        </a><a href="/tag/PHP/" class="
          inline-block
          font-sans
          font-semibold
          text-xs
          sm:text-sm
          px-2
          py-1
          mr-2
          mb-2
          rounded
          transition-color
          transition-bg
         text-gray-700 bg-gray-200 hover:text-white hover:bg-gray-700">
          PHP
        </a></div></div></div></header><div class="container m-auto max-w-3xl px-5 md:px-0"><article class="pt-5 border-grey-200"><div class="markdown text-lg leading-normal text-gray-700 pb-10"><p>Pada versi 6.0, Laravel menambahkan sebuah fitur baru yaitu <em>Lazy Collection</em>.
Dengan <em>Lazy Collection</em>, aplikasi Laravel dapat mengambil sekumpulan data dari database
tanpa harus menampung <strong>seluruh</strong> data tersebut kedalam memori. Di balik layar, <em>Lazy Collection</em>
memanfaatkan fitur <em>PHP Generator</em>. Beberapa waktu lalu, saya posting <a href="https://www.facebook.com/em.sifa/videos/vb.100000130485713/3270308866316764/" target="_blank" rel="nofollow noopener noreferrer">video</a> untuk menjelaskan bagaimana generator dapat menghemat penggunaan memori,
video berdurasi 20 menitan tersebut dapat membantu kamu untuk lebih memahami apa yang saya tuliskan disini.</p>
<p>Pada artikel ini, saya mau share bagaimana cara memanfaatkan <em>Lazy Collection</em> untuk melakukan streaming file CSV,
sehingga kita dapat melakukan export jutaan data tanpa harus menampung jutaan data tersebut ke dalam memori.</p>
<h4 id="kenapa-csv"><a href="#kenapa-csv" aria-hidden="true"><span class="icon icon-link"></span></a>Kenapa CSV?</h4>
<p>Kenapa menggunakan CSV?, kenapa bukan file excel aja?</p>
<p>Setahu saya, koreksi kalau salah loh ya. Saat ekspor data menjadi file excel, yang terjadi adalah
(jutaan) data kamu akan dibuffer/ditampung kedalam konten file excel, setelah selesai,
file tersebut masih diolah lagi untuk dilakukan proses encoding,
styling (membuat border, warnai teks, merge-cells, dsb), sampai akhirnya <em>buntelan</em> file excel kamu siap,
barulah file excel kamu "disajikan" ke browser.</p>
<p>Saat "memasak" (baca: mengolah) file excel tersebut, semakin banyak "porsi" (baca: baris) yang ingin dimasak, semakin besar pula "wajan" (baca: memori) yang harus digunakan untuk "memasak" file itu. Kalau "wajan"-nya tidak cukup besar, aplikasi kamu akan error, karena memorinya tidak mencukupi.</p>
<p>Berbeda dengan CSV, file CSV hanya berisi teks biasa (<em>plain text</em>) yang setiap barisnya mewakili baris pada tabel, dimana pada setiap baris terdapat karakter ";" atau "," sebagai pemisah dari masing-masing kolom. Kekurangannya, pada file CSV kita tidak bisa melakukan styling, formula, dsb seperti yang didukung oleh format excel. Tapi dengan kekurangan tersebut, kita dapat melakukan streaming konten CSV baris-per-baris, dari server dialirkan ke browser, dari browser dialirkan ke storage device user. Singkatnya: server kita tidak perlu menampung beban memori dari seluruh data di dalam file CSV yang hendak diekspor.</p>
<h4 id="kenapa-lazy-collection"><a href="#kenapa-lazy-collection" aria-hidden="true"><span class="icon icon-link"></span></a>Kenapa Lazy Collection?</h4>
<p>Kalau kamu pernah menonton video yang saya sebutkan di awal, kamu akan mengerti peran Lazy Collection disini.
Singkatnya, dengan Lazy Collection kita tidak perlu menampung data yang ingin kita ekspor,
sehingga yang terjadi adalah data dari hasil query akan difetch satu-per-satu dari DBMS, untuk kemudian data tersebut
ditulis kedalam stream file CSV yang akan diterima dan diproses langsung oleh web browser.</p>
<p>Secara keseluruhan, gambaran prosesnya nanti akan jadi (kurang-lebih) seperti ini:</p>
<p><img src="/images/posts/export-jutaan-data-ke-csv-dengan-aman-di-laravel__1.png" alt="Alur download stream csv"></p>
<h2 id="bagaimana-caranya"><a href="#bagaimana-caranya" aria-hidden="true"><span class="icon icon-link"></span></a>Bagaimana Caranya?</h2>
<p>Caranya sebetulnya sederhana.
Misalkan disini kita memiliki model <code>App\Models\LogActivity.php</code> yang mewakili table <code>log_activities</code> yang berisi 10 juta data.
Di dalam table tersebut, kita ingin export data <code>time</code>, <code>user_id</code>, <code>message</code>, <code>ip_address</code>, dan <code>user_agent</code>.</p>
<p>Supaya agak panjang artikelnya, misalnya isi file modelnya kayak gini:</p>
<div class='code-container'><pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #89DDFF">&lt;?</span><span style="color: #A6ACCD">php</span></span>

<span class="line"><span style="color: #F78C6C">namespace</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">Illuminate</span><span style="color: #89DDFF">\</span><span style="color: #FFCB6B">Database</span><span style="color: #89DDFF">\</span><span style="color: #FFCB6B">Eloquent</span><span style="color: #89DDFF">\</span><span style="color: #FFCB6B">Model</span><span style="color: #89DDFF">;</span></span>

<span class="line"><span style="color: #C792EA">class</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">LogActivity</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">extends</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">Model</span></span>
<span class="line"><span style="color: #89DDFF">{</span></span>

<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #C792EA">protected</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">table </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">log_activities</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">;</span></span>

<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div>
<p>Dah, gitulah ya.</p>
<p>Kemudian, kita menambahkan route seperti ini di <code>routes/web.php</code>:</p>
<div class='code-container'><pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #FFCB6B">Route</span><span style="color: #89DDFF">::</span><span style="color: #82AAFF">get</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">log-activities/export</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">LogActivityController@export</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">);</span></span></code></pre></div>
<p>Setelah itu, pada controllernya kamu dapat menuliskan seperti ini:</p>
<div class='code-container'><pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #89DDFF">&lt;?</span><span style="color: #A6ACCD">php</span></span>

<span class="line"><span style="color: #F78C6C">namespace</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">App</span><span style="color: #89DDFF">\</span><span style="color: #FFCB6B">Http</span><span style="color: #89DDFF">\</span><span style="color: #FFCB6B">Controllers</span><span style="color: #89DDFF">;</span></span>

<span class="line"><span style="color: #F78C6C">use</span><span style="color: #FFCB6B"> </span><span style="color: #A6ACCD">App</span><span style="color: #89DDFF">\</span><span style="color: #A6ACCD">Models</span><span style="color: #89DDFF">\</span><span style="color: #A6ACCD">LogActivity</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #F78C6C">use</span><span style="color: #FFCB6B"> </span><span style="color: #A6ACCD">Illuminate</span><span style="color: #89DDFF">\</span><span style="color: #A6ACCD">Http</span><span style="color: #89DDFF">\</span><span style="color: #A6ACCD">Request</span><span style="color: #89DDFF">;</span></span>

<span class="line"><span style="color: #C792EA">class</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">LogActivityController</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">extends</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">Controller</span></span>
<span class="line"><span style="color: #89DDFF">{</span></span>

<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #C792EA">public</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">function</span><span style="color: #A6ACCD"> </span><span style="color: #82AAFF">export</span><span style="color: #89DDFF">()</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #89DDFF">        </span><span style="color: #676E95">// 1. Ambil seluruh data log_activities kedalam LazyCollection (Generator)</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">logs </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">LogActivity</span><span style="color: #89DDFF">::</span><span style="color: #82AAFF">orderBy</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">time</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">)-&gt;</span><span style="color: #82AAFF">cursor</span><span style="color: #89DDFF">();</span></span>

<span class="line"><span style="color: #89DDFF">        </span><span style="color: #676E95">// FYI: dibawah ini contoh kalau kamu mau gunakan condition dengan cursor</span></span>
<span class="line"><span style="color: #89DDFF">        </span><span style="color: #676E95">// $logs = LogActivity::whereRaw(&quot;DATE(time) = &#39;2019-11-08&#39;&quot;)-&gt;where(&#39;user_id&#39;, 1)-&gt;cursor()</span></span>

<span class="line"><span style="color: #89DDFF">        </span><span style="color: #676E95">// 2. Set header untuk streaming file CSV</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">filename </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">log-activities.csv</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #82AAFF">header</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">Content-type: text/csv</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #82AAFF">header</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">Content-Disposition: attachment; filename=</span><span style="color: #89DDFF">{$</span><span style="color: #A6ACCD">filename</span><span style="color: #89DDFF">}&quot;</span><span style="color: #89DDFF">);</span></span>

<span class="line"><span style="color: #89DDFF">        </span><span style="color: #676E95">// 3. Stream file CSV</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">csv </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> </span><span style="color: #82AAFF">fopen</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">php://output</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">w+</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span>
<span class="line"><span style="color: #89DDFF">        </span><span style="color: #676E95">// 3.a. Tulis table header</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #82AAFF">fputcsv</span><span style="color: #89DDFF">($</span><span style="color: #A6ACCD">csv</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">Time</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">User ID</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">Message</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">IP Address</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">User Agent</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">]);</span></span>
<span class="line"><span style="color: #89DDFF">        </span><span style="color: #676E95">// 3.b. Tulis baris setiap log</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">foreach</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">($</span><span style="color: #A6ACCD">logs </span><span style="color: #89DDFF">as</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">log</span><span style="color: #89DDFF">)</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #82AAFF">fputcsv</span><span style="color: #89DDFF">($</span><span style="color: #A6ACCD">csv</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">[</span></span>
<span class="line"><span style="color: #A6ACCD">                </span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">log</span><span style="color: #89DDFF">-&gt;</span><span style="color: #A6ACCD">time</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #A6ACCD">                </span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">log</span><span style="color: #89DDFF">-&gt;</span><span style="color: #A6ACCD">user_id</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #A6ACCD">                </span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">log</span><span style="color: #89DDFF">-&gt;</span><span style="color: #A6ACCD">message</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #A6ACCD">                </span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">log</span><span style="color: #89DDFF">-&gt;</span><span style="color: #A6ACCD">ip_address</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #A6ACCD">                </span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">log</span><span style="color: #89DDFF">-&gt;</span><span style="color: #A6ACCD">user_agent</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #89DDFF">]);</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">        </span><span style="color: #676E95">// 3.c. Tutup file</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #82AAFF">fclose</span><span style="color: #89DDFF">($</span><span style="color: #A6ACCD">csv</span><span style="color: #89DDFF">);</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #89DDFF">}</span></span>

<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div>
<p>Selesai. Dengan begitu, ketika kamu mengakses <code>https://appkamu.com/log-activities/export</code>,
aplikasi kamu akan mengirimkan response berupa streaming file CSV yang berisi semua data didalam <code>log_activities</code>
tanpa harus mengalami beban memori yang tinggi.</p>
<hr>
<p>Ngomong-ngomong, cara diatas adalah cara yang agak native karena kita langsung menggunakan fungsi <code>header</code> bawaan PHP.
Saya tulis seperti itu supaya kamu tahu cara di native atau di framework lain seperti apa.
Kalau kamu penasaran cara yang "lebih" ke-Laravel-an, kamu dapat menggunakan fungsi <code>streamDownload</code> seperti dibawah ini:</p>
<div class='code-container'><pre class="shiki" style="background-color: #292D3E"><code><span class="line"><span style="color: #89DDFF">&lt;?</span><span style="color: #A6ACCD">php</span></span>

<span class="line"><span style="color: #F78C6C">namespace</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">App</span><span style="color: #89DDFF">\</span><span style="color: #FFCB6B">Http</span><span style="color: #89DDFF">\</span><span style="color: #FFCB6B">Controllers</span><span style="color: #89DDFF">;</span></span>

<span class="line"><span style="color: #F78C6C">use</span><span style="color: #FFCB6B"> </span><span style="color: #A6ACCD">App</span><span style="color: #89DDFF">\</span><span style="color: #A6ACCD">Models</span><span style="color: #89DDFF">\</span><span style="color: #A6ACCD">LogActivity</span><span style="color: #89DDFF">;</span></span>
<span class="line"><span style="color: #F78C6C">use</span><span style="color: #FFCB6B"> </span><span style="color: #A6ACCD">Illuminate</span><span style="color: #89DDFF">\</span><span style="color: #A6ACCD">Http</span><span style="color: #89DDFF">\</span><span style="color: #A6ACCD">Request</span><span style="color: #89DDFF">;</span></span>

<span class="line"><span style="color: #C792EA">class</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">LogActivityController</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">extends</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">Controller</span></span>
<span class="line"><span style="color: #89DDFF">{</span></span>

<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #C792EA">public</span><span style="color: #A6ACCD"> </span><span style="color: #C792EA">function</span><span style="color: #A6ACCD"> </span><span style="color: #82AAFF">export</span><span style="color: #89DDFF">()</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">logs </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> </span><span style="color: #FFCB6B">LogActivity</span><span style="color: #89DDFF">::</span><span style="color: #82AAFF">orderBy</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">time</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">)-&gt;</span><span style="color: #82AAFF">cursor</span><span style="color: #89DDFF">();</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">filename </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">log-activities.csv</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">;</span></span>

<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">return</span><span style="color: #A6ACCD"> </span><span style="color: #82AAFF">response</span><span style="color: #89DDFF">()-&gt;</span><span style="color: #82AAFF">streamDownload</span><span style="color: #89DDFF">(</span><span style="color: #C792EA">function</span><span style="color: #89DDFF">()</span><span style="color: #A6ACCD"> </span><span style="color: #F78C6C">use</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">($</span><span style="color: #A6ACCD">logs</span><span style="color: #89DDFF">)</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">csv </span><span style="color: #89DDFF">=</span><span style="color: #A6ACCD"> </span><span style="color: #82AAFF">fopen</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">php://output</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">w+</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span>

<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #82AAFF">fputcsv</span><span style="color: #89DDFF">($</span><span style="color: #A6ACCD">csv</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">Time</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">User ID</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">Message</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">IP Address</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">User Agent</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">]);</span></span>

<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #89DDFF">foreach</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">($</span><span style="color: #A6ACCD">logs </span><span style="color: #89DDFF">as</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">log</span><span style="color: #89DDFF">)</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #A6ACCD">                </span><span style="color: #82AAFF">fputcsv</span><span style="color: #89DDFF">($</span><span style="color: #A6ACCD">csv</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">[</span></span>
<span class="line"><span style="color: #A6ACCD">                    </span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">log</span><span style="color: #89DDFF">-&gt;</span><span style="color: #A6ACCD">time</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #A6ACCD">                    </span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">log</span><span style="color: #89DDFF">-&gt;</span><span style="color: #A6ACCD">user_id</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #A6ACCD">                    </span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">log</span><span style="color: #89DDFF">-&gt;</span><span style="color: #A6ACCD">message</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #A6ACCD">                    </span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">log</span><span style="color: #89DDFF">-&gt;</span><span style="color: #A6ACCD">ip_address</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #A6ACCD">                    </span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">log</span><span style="color: #89DDFF">-&gt;</span><span style="color: #A6ACCD">user_agent</span></span>
<span class="line"><span style="color: #A6ACCD">                </span><span style="color: #89DDFF">]);</span></span>
<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #89DDFF">}</span></span>

<span class="line"><span style="color: #A6ACCD">            </span><span style="color: #82AAFF">fclose</span><span style="color: #89DDFF">($</span><span style="color: #A6ACCD">csv</span><span style="color: #89DDFF">);</span></span>
<span class="line"><span style="color: #A6ACCD">        </span><span style="color: #89DDFF">},</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">filename</span><span style="color: #89DDFF">,</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">Content-type</span><span style="color: #89DDFF">&quot;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">=&gt;</span><span style="color: #A6ACCD"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">text/csv</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">]);</span></span>
<span class="line"><span style="color: #A6ACCD">    </span><span style="color: #89DDFF">}</span></span>

<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div>
<hr>
<p>Seperti itulah cara melakukan export CSV secara aman di Laravel. Kalau ada saran, masukan, atau pertanyaan, silahkan kontak facebook saya.
Akhir kata, semoga bermanfaat.</p>
</div></article></div><section class="mb-10 py-16 bg-gray-200 text-gray-700"><div class="container m-auto max-w-3xl px-5 md:px-0"><div class="flex"><div class="w-10/12 mx-auto"><h4 class="text-2xl font-semibold mb-4 -mt-4">Suka artikel ini?</h4><p class="mb-8">
          Saya biasanya share artikel-artikel terbaru via
          <strong class="text-gray-700">facebook</strong> atau <strong class="text-gray-700">fanpage foobarology</strong> saya.
          Kalau mau dapat updatenya, di add friend/like/follow aja link-link dibawah ini ðŸ˜ƒ
        </p><a target="_blank" rel="noopener" href="https://www.facebook.com/em.sifa" class="px-4 py-2 text-lg text-white bg-gray-600 hover:bg-blue-500 rounded">
          Facebook
        </a><a target="_blank" rel="noopener" href="https://www.facebook.com/foobarology" class="ml-3 px-4 py-2 text-lg text-white bg-gray-600 hover:bg-blue-500 rounded">
          Foobarology
        </a></div></div></div></section><footer class="text-gray-700 text-sm leading-normal flex flex-wrap justify-between mx-auto max-w-3xl px-6 sm:px-12 pb-8 sm:pb-10"><div class="w-full sm:w-1/2 mb-4 sm:mb-0 text-gray-700"><p>Â© 2019</p></div><div class="w-full sm:w-1/2"><nav><ul class="flex sm:justify-end -mx-2"><li class="px-2"><a href="/" class="text-gray-700 border-b border-transparent hover:border-gray-400 transition-border-color active">Home</a></li><li class="px-2"><a href="/sitemap.xml" class="text-gray-700 border-b border-transparent hover:border-gray-400 transition-border-color">Sitemap</a></li><li class="px-2"><a href="/feed.xml" class="text-gray-700 border-b border-transparent hover:border-gray-400 transition-border-color">RSS Feed</a></li></ul></nav></div></footer></main></div>
    <script src="/assets/js/app.7018cf29.js" defer></script><script src="/assets/js/page--src-templates-post-vue.c0e9f36f.js" defer></script>
  </body>
</html>
