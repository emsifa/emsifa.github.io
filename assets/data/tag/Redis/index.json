{"hash":"1edf71e944044bc70c25b692f010f187723da530","data":{"tag":{"id":"Redis","title":"Redis","path":"/tag/Redis/","belongsTo":{"totalCount":1,"pageInfo":{"totalPages":1,"currentPage":1},"edges":[{"node":{"id":"b86316117b02f0df7b890fc2071827cc","title":"Membuat API Rate Limiting menggunakan Redis pada Express.js","datetime":"2019-12-01 11:00:00","path":"/artikel/membuat-api-rate-limiting-redis-express/","icon":"/images/icons/redis.png","content":"<p>Beberapa waktu yang lalu, saya sempat menuliskan catatan kursus Redis saya di <a href=\"university.redislabs.com/\">Redis University</a>. Tapi catatannya tidak saya lanjutkan karena <del>materi yang dibahas antar kelas yang satu dengan kelas yang lainnya banyak yang mirip-mirip</del> saya malas. Sebagai gantinya, saya akan menuliskan beberapa artikel Redis yang sekiranya banyak dibutuhkan oleh industri. Salah satunya adalah Rate Limiting ini.</p>\n<p>Rate Limiting (dalam konteks aplikasi web) adalah proses membatasi jumlah request user/client pada resource tertentu. Sebagai contoh disini kita akan coba membatasi akses user terhadap API yang dibuat menggunakan Express.js pada setiap menitnya.</p>\n<p>Sebelum mencoba ini, pastikan kamu sudah menginstall <strong><a href=\"https://redis.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Redis</a></strong> dan <strong><a href=\"https://nodejs.org/en/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Node.js</a></strong> terlebih dahulu. Pada tutorial ini saya menggunakan Node.js versi 10.15.3 dan Redis versi 5.0.5. Buat kamu yang pakai Windows seperti saya, kamu dapat menjalankan Redis dengan Docker.</p>\n<h2 id=\"kenapa-redis\"><a href=\"#kenapa-redis\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Kenapa Redis?</h2>\n<p>Untuk membuat Rate Limiting kita bisa saja menggunakan NginX atau session.\nTapi kenapa Redis?</p>\n<ul>\n<li>Dibandingkan dengan NginX, Rate Limiting menggunakan Redis lebih fleksibel karena kita sendiri yang mengatur logic dari Rate Limiternya.</li>\n<li>Performa Redis yang menggunakan penyimpanan pada RAM lebih cepat ketimbang session yang (biasanya) menggunakan file atau database lain yang menggunakan penyimpanan fisik.</li>\n<li>Redis mendukung banyak platform dan memiliki ketersediaan library di berbagai bahasa pemrograman.</li>\n</ul>\n<h2 id=\"persiapan\"><a href=\"#persiapan\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Persiapan</h2>\n<p>Saya akan <em>to-the-point</em> aja disini, kalau bingung silahkan tanya saya via <a href=\"https://www.facebook.com/em.sifa\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">facebook</a>.</p>\n<ul>\n<li>Buka terminal atau cmd (selanjutnya saya akan sebut terminal aja).</li>\n<li>Buat direktori baru: <code>mkdir express-rate-limiting</code>.</li>\n<li>Masuk ke direktori tersebut: <code>cd express-rate-limiting</code>.</li>\n<li>Inisiasi file package.json: <code>npm init -y</code>.</li>\n<li>Install package yang dibutuhkan: <code>npm i -S express redis bluebird date-fns</code>.</li>\n<li>Buka terminal lain, jalankan redis-server.</li>\n</ul>\n<p>Berikut sedikit penjelasan tentang package yang kita install diatas:</p>\n<ul>\n<li><code>express</code>: untuk membuat Web API.</li>\n<li><code>redis</code>: untuk koneksi dan mengirim perintah ke redis server.</li>\n<li><code>bluebird</code>: untuk membuat versi Promise pada setiap API/function di package redis.</li>\n<li><code>date-fns</code>: untuk format tanggal.</li>\n</ul>\n<h2 id=\"konsep\"><a href=\"#konsep\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Konsep</h2>\n<p>Goal pada aplikasi yang akan kita buat disini adalah untuk\nmembatasi akses ke endpoint <code>GET /hello</code> supaya setiap IP\nhanya dapat mengakses sebanyak 10 kali saja setiap menitnya.</p>\n<p>Untuk mencapai goal tersebut, kita akan memanfaatkan 3 perintah redis, yaitu:</p>\n<ul>\n<li><code>GET</code>: untuk mengambil nilai dari key.</li>\n<li><code>INCR</code>: untuk increment nilai numerik dari key.</li>\n<li><code>EXPIRE</code>: untuk set expiration key supaya nilai dari keynya otomatis hilang dalam kurun waktu tertentu, sehingga tidak membebani memori berkepanjangan. Istilah kerennya <em>time-based retention</em>.</li>\n</ul>\n<p>Pemanfaatannya adalah sebagai berikut:</p>\n<ul>\n<li>Ambil jumlah akses (nilai numerik) dari key menggunakan <code>GET</code>.</li>\n<li>\n<p>Jika jumlah akses melebihi batas (10):</p>\n<ul>\n<li>Kirim response error 429 (Too Many Requests).</li>\n</ul>\n</li>\n<li>\n<p>Jika jumlah akses dibawah atau sama dengan batas (10):</p>\n<ul>\n<li>Increment nilai dari key menggunakan <code>INCR</code>.</li>\n<li>Set expire dari key menggunakan <code>EXPIRE</code>.</li>\n<li>Kirim response sukses.</li>\n</ul>\n</li>\n</ul>\n<p>Supaya <u>setiap IP</u> hanya boleh mengakses <u>path tertentu</u> pada <u>setiap menitnya</u>.\nKita akan membuat keynya dengan format seperti ini:</p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">{</span><span style=\"color: #A6ACCD\">IP</span><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\">:</span><span style=\"color: #89DDFF\">{</span><span style=\"color: #A6ACCD\">PATH</span><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\">:</span><span style=\"color: #89DDFF\">{</span><span style=\"color: #A6ACCD\">TAHUN</span><span style=\"color: #89DDFF\">}{</span><span style=\"color: #A6ACCD\">BULAN</span><span style=\"color: #89DDFF\">}{</span><span style=\"color: #A6ACCD\">TANGGAL</span><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\">:</span><span style=\"color: #89DDFF\">{</span><span style=\"color: #A6ACCD\">JAM</span><span style=\"color: #89DDFF\">}{</span><span style=\"color: #A6ACCD\">MENIT</span><span style=\"color: #89DDFF\">}</span></span></code></pre></div>\n<p>Contoh jika IP <code>1.2.3.4</code> mengakses <code>\"/hello\"</code> pada <code>2019-12-01 10:15:25</code>. Keynya akan seperti ini:</p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #A6ACCD\">1.2.3.4:/hello:20191201:1015</span></span></code></pre></div>\n<p>Sebagai gambaran, berikut adalah table skenario request yang dijalankan oleh <code>1.2.3.4</code> ke path <code>/hello</code> pada waktu tertentu:</p>\n<div class=\"table-responsive\">\n<table>\n<thead>\n<tr>\n<th align=\"center\"><strong>No.</strong></th>\n<th align=\"center\"><strong>Waktu</strong></th>\n<th align=\"center\"><strong>Key</strong></th>\n<th align=\"center\"><strong>Value</strong></th>\n<th align=\"center\"><strong>Hasil</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">1</td>\n<td align=\"center\">2019-12-01 10:01:00</td>\n<td align=\"center\">1.2.3.4:/hello:20191201:1001</td>\n<td align=\"center\">1</td>\n<td align=\"center\"><strong class=\"text-green-500\">sukses</strong></td>\n</tr>\n<tr>\n<td align=\"center\">2</td>\n<td align=\"center\">2019-12-01 10:01:01</td>\n<td align=\"center\">1.2.3.4:/hello:20191201:1001</td>\n<td align=\"center\">2</td>\n<td align=\"center\"><strong class=\"text-green-500\">sukses</strong></td>\n</tr>\n<tr>\n<td align=\"center\">3</td>\n<td align=\"center\">2019-12-01 10:01:05</td>\n<td align=\"center\">1.2.3.4:/hello:20191201:1001</td>\n<td align=\"center\">3</td>\n<td align=\"center\"><strong class=\"text-green-500\">sukses</strong></td>\n</tr>\n<tr>\n<td align=\"center\">4</td>\n<td align=\"center\">2019-12-01 10:01:12</td>\n<td align=\"center\">1.2.3.4:/hello:20191201:1001</td>\n<td align=\"center\">4</td>\n<td align=\"center\"><strong class=\"text-green-500\">sukses</strong></td>\n</tr>\n<tr>\n<td align=\"center\">5</td>\n<td align=\"center\">2019-12-01 10:01:16</td>\n<td align=\"center\">1.2.3.4:/hello:20191201:1001</td>\n<td align=\"center\">5</td>\n<td align=\"center\"><strong class=\"text-green-500\">sukses</strong></td>\n</tr>\n<tr>\n<td align=\"center\">6</td>\n<td align=\"center\">2019-12-01 10:01:18</td>\n<td align=\"center\">1.2.3.4:/hello:20191201:1001</td>\n<td align=\"center\">6</td>\n<td align=\"center\"><strong class=\"text-green-500\">sukses</strong></td>\n</tr>\n<tr>\n<td align=\"center\">7</td>\n<td align=\"center\">2019-12-01 10:01:19</td>\n<td align=\"center\">1.2.3.4:/hello:20191201:1001</td>\n<td align=\"center\">7</td>\n<td align=\"center\"><strong class=\"text-green-500\">sukses</strong></td>\n</tr>\n<tr>\n<td align=\"center\">8</td>\n<td align=\"center\">2019-12-01 10:01:21</td>\n<td align=\"center\">1.2.3.4:/hello:20191201:1001</td>\n<td align=\"center\">8</td>\n<td align=\"center\"><strong class=\"text-green-500\">sukses</strong></td>\n</tr>\n<tr>\n<td align=\"center\">9</td>\n<td align=\"center\">2019-12-01 10:01:25</td>\n<td align=\"center\">1.2.3.4:/hello:20191201:1001</td>\n<td align=\"center\">9</td>\n<td align=\"center\"><strong class=\"text-green-500\">sukses</strong></td>\n</tr>\n<tr>\n<td align=\"center\">10</td>\n<td align=\"center\">2019-12-01 10:01:30</td>\n<td align=\"center\">1.2.3.4:/hello:20191201:1001</td>\n<td align=\"center\">10</td>\n<td align=\"center\"><strong class=\"text-green-500\">sukses</strong></td>\n</tr>\n<tr>\n<td align=\"center\">11</td>\n<td align=\"center\">2019-12-01 10:01:36</td>\n<td align=\"center\">1.2.3.4:/hello:20191201:1001</td>\n<td align=\"center\">11</td>\n<td align=\"center\"><strong class=\"text-red-500\">error</strong></td>\n</tr>\n<tr>\n<td align=\"center\">12</td>\n<td align=\"center\">2019-12-01 10:01:40</td>\n<td align=\"center\">1.2.3.4:/hello:20191201:1001</td>\n<td align=\"center\">11</td>\n<td align=\"center\"><strong class=\"text-red-500\">error</strong></td>\n</tr>\n<tr>\n<td align=\"center\">13</td>\n<td align=\"center\">2019-12-01 10:<strong class=\"bg-gray-200 text-gray-800\">02</strong>:05</td>\n<td align=\"center\">1.2.3.4:/hello:20191201:10<strong class=\"bg-gray-200 text-gray-800\">02</strong></td>\n<td align=\"center\"><strong class=\"bg-gray-200 text-gray-800\">1</strong></td>\n<td align=\"center\"><strong class=\"text-green-500\">sukses</strong></td>\n</tr>\n</tbody>\n</table>\n</div>\n<h2 id=\"implementasi\"><a href=\"#implementasi\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Implementasi</h2>\n<p>Sekarang saatnya masuk ke <em>text editor</em> atau <em>IDE</em> favorit kamu.\nPertama-tama silahkan buat file <code>app.js</code> pada direktori yang sama dengan file <code>package.json</code>.\nLalu kita akan masuk ke tahap berikutnya.</p>\n<h4 id=\"1-import-package\"><a href=\"#1-import-package\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>1. Import Package</h4>\n<p>Sebelum menuliskan <em>app logic</em>-nya, mari kita import dulu <em>package</em> yang sudah kita install sebelumnya.</p>\n<p>Isikan kode seperti dibawah ini pada file <code>app.js</code> kamu:</p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span><span style=\"color: #A6ACCD\"> format </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">require</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">date-fns</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #A6ACCD\">)</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> express </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">require</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">express</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #A6ACCD\">)</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> bluebird </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">require</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">bluebird</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #A6ACCD\">)</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> redis </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">require</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">redis</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #A6ACCD\">)</span></span></code></pre></div>\n<h4 id=\"2-promisify\"><a href=\"#2-promisify\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>2. Promisify</h4>\n<p>Pada tahap ini kita akan menggunakan bluebird untuk menambahkan <em>Promise-based</em> function pada setiap API/function yang tersedia pada <em>package</em> redis.</p>\n<p>Silahkan tambahkan baris berikut setelah <em>require-require</em> sebelumnya.</p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #A6ACCD\">bluebird</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">promisifyAll</span><span style=\"color: #A6ACCD\">(redis)</span></span></code></pre></div>\n<blockquote>\n<p>Promise-based function berfungsi untuk menghindari <a href=\"http://callbackhell.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">callback-hell</a></p>\n</blockquote>\n<h4 id=\"3-membuat-dan-menghubungkan-redis-client\"><a href=\"#3-membuat-dan-menghubungkan-redis-client\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>3. Membuat dan Menghubungkan Redis Client</h4>\n<p>Selanjutnya, untuk dapat mengirimkan perintah ke redis-server, kita perlu membuat dan menghubungkan redis client terlebih dahulu.</p>\n<p>Tambahkan baris berikut dibawah tahap sebelumnya:</p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> client </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> redis</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">createClient</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #F07178\">host</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">127.0.0.1</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #F07178\">port</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #F78C6C\">6379</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\">)</span></span></code></pre></div>\n<p>Kalau sudah, kamu dapat test koneksi menggunakan terminal dengan perintah:</p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #A6ACCD\">node app</span></span></code></pre></div>\n<p>Tunggu sebentar, kalau muncul error <code>ECONNREFUSED</code>, kemungkinannya:</p>\n<ul>\n<li>Redis server belum running</li>\n<li>Hostnya salah</li>\n<li>Portnya salah</li>\n</ul>\n<p>Silahkan cek dan sesuaikan lagi.</p>\n<h4 id=\"4-inisiasi-express-app\"><a href=\"#4-inisiasi-express-app\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>4. Inisiasi Express App</h4>\n<p>Setelah koneksi redis client berhasil, saatnya kita membuat aplikasi webnya.</p>\n<p>Lanjut dibawah kode sebelumnya. Ketikkan kode berikut:</p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> port </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #F78C6C\">3000</span><span style=\"color: #A6ACCD\">     </span><span style=\"color: #676E95\">// definisikan port</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> app </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">express</span><span style=\"color: #A6ACCD\">() </span><span style=\"color: #676E95\">// inisiasi web app</span></span>\n\n<span class=\"line\"><span style=\"color: #676E95\">// Daftarkan endpoint &quot;GET /hello&quot;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">app</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">/hello</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #A6ACCD\">req</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> res</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #A6ACCD\">res</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">json</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    message</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">Hello world</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\">)</span></span>\n\n<span class=\"line\"><span style=\"color: #676E95\">// Jalankan web app</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">app</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">listen</span><span style=\"color: #A6ACCD\">(port</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #A6ACCD\">console</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">log</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">`</span><span style=\"color: #C3E88D\">App listening on port </span><span style=\"color: #89DDFF\">${</span><span style=\"color: #A6ACCD\">port</span><span style=\"color: #89DDFF\">}</span><span style=\"color: #C3E88D\">!</span><span style=\"color: #89DDFF\">`</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\">)</span></span></code></pre></div>\n<hr>\n<details><summary>Kode keseluruhan pada tahap ini:</summary>\n<p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span><span style=\"color: #A6ACCD\"> format </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">require</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">date-fns</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #A6ACCD\">)</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> express </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">require</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">express</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #A6ACCD\">)</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> bluebird </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">require</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">bluebird</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #A6ACCD\">)</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> redis </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">require</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">redis</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #A6ACCD\">)</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">bluebird</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">promisifyAll</span><span style=\"color: #A6ACCD\">(redis)</span></span>\n\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> client </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> redis</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">createClient</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #F07178\">host</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">127.0.0.1</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #F07178\">port</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #F78C6C\">6379</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\">)</span></span>\n\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> port </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #F78C6C\">3000</span><span style=\"color: #A6ACCD\">     </span><span style=\"color: #676E95\">// definisikan port</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> app </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">express</span><span style=\"color: #A6ACCD\">() </span><span style=\"color: #676E95\">// inisiasi web app</span></span>\n\n<span class=\"line\"><span style=\"color: #676E95\">// Daftarkan endpoint &quot;GET /hello&quot;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">app</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">/hello</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #A6ACCD\">req</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> res</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #A6ACCD\">res</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">json</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    message</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">Hello world</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\">)</span></span>\n\n<span class=\"line\"><span style=\"color: #676E95\">// Jalankan web app</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">app</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">listen</span><span style=\"color: #A6ACCD\">(port</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #A6ACCD\">console</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">log</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">`</span><span style=\"color: #C3E88D\">App listening on port </span><span style=\"color: #89DDFF\">${</span><span style=\"color: #A6ACCD\">port</span><span style=\"color: #89DDFF\">}</span><span style=\"color: #C3E88D\">!</span><span style=\"color: #89DDFF\">`</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\">)</span></span></code></pre></div>\n</p>\n</details>\n<hr>\n<h4 id=\"5-menerapkan-rate-limiting-pada-endpoint-get-hello\"><a href=\"#5-menerapkan-rate-limiting-pada-endpoint-get-hello\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>5. Menerapkan Rate Limiting pada Endpoint \"GET /hello\"</h4>\n<p>Pada tahap ini kita akan memanfaatkan redis client untuk membatasi akses ke endpoint <code>GET /hello</code>\nsupaya setiap IP hanya dapat mengakses sebanyak 10 kali saja pada setiap menitnya.</p>\n<p>Silahkan ubah <code>app.get('/hello', ...)</code> pada tahap sebelumnya menjadi seperti ini (pahami penjelasan baris-per-baris):</p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #A6ACCD\">app</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">/hello</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">async</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #A6ACCD\">req</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> res</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">limit</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">10</span><span style=\"color: #F07178\">      </span><span style=\"color: #676E95\">// limit akses setiap menitnya</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">path</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">/hello</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #F07178\"> </span><span style=\"color: #676E95\">// path dari API</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">time</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">format</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">new</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">Date</span><span style=\"color: #F07178\">()</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">yyyyMMdd:HHmm</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #F07178\">) </span><span style=\"color: #676E95\">// waktu untuk dijadikan key  </span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95\">// Set redis key yang digunakan untuk menyimpan </span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95\">// jumlah akses oleh IP: req.ip, untuk path: path, pada menit: time</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">key</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">`${</span><span style=\"color: #A6ACCD\">req</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #A6ACCD\">ip</span><span style=\"color: #89DDFF\">}</span><span style=\"color: #C3E88D\">:</span><span style=\"color: #89DDFF\">${</span><span style=\"color: #A6ACCD\">path</span><span style=\"color: #89DDFF\">}</span><span style=\"color: #C3E88D\">:</span><span style=\"color: #89DDFF\">${</span><span style=\"color: #A6ACCD\">time</span><span style=\"color: #89DDFF\">}`</span><span style=\"color: #F07178\"> </span></span>\n\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95\">// Ambil jumlah akses saat ini</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">count</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">parseInt</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">await</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">client</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getAsync</span><span style=\"color: #F07178\">(</span><span style=\"color: #A6ACCD\">key</span><span style=\"color: #F07178\">))</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95\">// Kalau jumlah akses melebihi limit ...</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">if</span><span style=\"color: #F07178\"> (</span><span style=\"color: #A6ACCD\">count</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">limit</span><span style=\"color: #F07178\">) </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">      </span><span style=\"color: #676E95\">// ... kirim response error 429</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">return</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">res</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">status</span><span style=\"color: #F07178\">(</span><span style=\"color: #F78C6C\">429</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">json</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      error</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">429</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      message</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">`</span><span style=\"color: #C3E88D\">API rate limit exceeded</span><span style=\"color: #89DDFF\">`</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">}</span></span>\n\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95\">// Jalankan transaction untuk:</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">trx</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">client</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">multi</span><span style=\"color: #F07178\">()</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #A6ACCD\">trx</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">incr</span><span style=\"color: #F07178\">(</span><span style=\"color: #A6ACCD\">key</span><span style=\"color: #F07178\">)         </span><span style=\"color: #676E95\">// 1. increment key</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #A6ACCD\">trx</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">expire</span><span style=\"color: #F07178\">(</span><span style=\"color: #A6ACCD\">key</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">60</span><span style=\"color: #F07178\">)   </span><span style=\"color: #676E95\">// 2. set expire key 60 detik</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">await</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">trx</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">execAsync</span><span style=\"color: #F07178\">()</span></span>\n\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95\">// Kirim response yang seharusnya</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #A6ACCD\">res</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">json</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      message</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">Hello world</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\">)</span></span></code></pre></div>\n<p>Hmm, panjang juga ya. Kalau belum paham, baca ulang lagi aja sampai paham.</p>\n<p>Pada saat mengeset variable <code>key</code>, kamu dapat sesuaikan sesuai kebutuhan kamu.\nMisal untuk IP diatas dapat kamu ganti dengan token.\nAtau misal kamu mau batasinya per jam, kamu dapat ubah format<code>time</code>-nya menjadi <code>yyyyMMdd:HH</code> aja.\nAtau misalkan lagi kamu mau batasi secara global, bukan hanya pada path <code>/hello</code> aja,\nkamu dapat hilangkan informasi <code>path</code> pada <code>key</code>-nya.</p>\n<hr>\n<details><summary>Kode keseluruhan pada tahap ini:</summary>\n<p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span><span style=\"color: #A6ACCD\"> format </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">require</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">date-fns</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #A6ACCD\">)</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> express </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">require</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">express</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #A6ACCD\">)</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> bluebird </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">require</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">bluebird</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #A6ACCD\">)</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> redis </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">require</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">redis</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #A6ACCD\">)</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">bluebird</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">promisifyAll</span><span style=\"color: #A6ACCD\">(redis)</span></span>\n\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> client </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> redis</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">createClient</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #F07178\">host</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">127.0.0.1</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #F07178\">port</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #F78C6C\">6379</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\">)</span></span>\n\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> port </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #F78C6C\">3000</span><span style=\"color: #A6ACCD\">     </span><span style=\"color: #676E95\">// definisikan port</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> app </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">express</span><span style=\"color: #A6ACCD\">() </span><span style=\"color: #676E95\">// inisiasi web app</span></span>\n\n<span class=\"line\"><span style=\"color: #676E95\">// Daftarkan endpoint &quot;GET /hello&quot;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">app</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">/hello</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">async</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #A6ACCD\">req</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> res</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">limit</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">10</span><span style=\"color: #F07178\">      </span><span style=\"color: #676E95\">// limit akses setiap menitnya</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">path</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">/hello</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #F07178\"> </span><span style=\"color: #676E95\">// path dari API</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">time</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">format</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">new</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">Date</span><span style=\"color: #F07178\">()</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">yyyyMMdd:HHmm</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #F07178\">) </span><span style=\"color: #676E95\">// waktu untuk dijadikan key  </span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95\">// Set redis key yang digunakan untuk menyimpan </span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95\">// jumlah akses oleh IP: req.ip, untuk path: path, pada menit: time</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">key</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">`${</span><span style=\"color: #A6ACCD\">req</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #A6ACCD\">ip</span><span style=\"color: #89DDFF\">}</span><span style=\"color: #C3E88D\">:</span><span style=\"color: #89DDFF\">${</span><span style=\"color: #A6ACCD\">path</span><span style=\"color: #89DDFF\">}</span><span style=\"color: #C3E88D\">:</span><span style=\"color: #89DDFF\">${</span><span style=\"color: #A6ACCD\">time</span><span style=\"color: #89DDFF\">}`</span><span style=\"color: #F07178\"> </span></span>\n\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95\">// Ambil jumlah akses saat ini</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">count</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">parseInt</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">await</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">client</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getAsync</span><span style=\"color: #F07178\">(</span><span style=\"color: #A6ACCD\">key</span><span style=\"color: #F07178\">))</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95\">// Kalau jumlah akses melebihi limit ...</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">if</span><span style=\"color: #F07178\"> (</span><span style=\"color: #A6ACCD\">count</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">limit</span><span style=\"color: #F07178\">) </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">    </span><span style=\"color: #676E95\">// ... kirim response error 429</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">return</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">res</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">status</span><span style=\"color: #F07178\">(</span><span style=\"color: #F78C6C\">429</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">json</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      error</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">429</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      message</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">`</span><span style=\"color: #C3E88D\">API rate limit exceeded</span><span style=\"color: #89DDFF\">`</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">}</span></span>\n\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95\">// Jalankan transaction untuk:</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">trx</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">client</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">multi</span><span style=\"color: #F07178\">()</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #A6ACCD\">trx</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">incr</span><span style=\"color: #F07178\">(</span><span style=\"color: #A6ACCD\">key</span><span style=\"color: #F07178\">)         </span><span style=\"color: #676E95\">// 1. increment key</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #A6ACCD\">trx</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">expire</span><span style=\"color: #F07178\">(</span><span style=\"color: #A6ACCD\">key</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">60</span><span style=\"color: #F07178\">)   </span><span style=\"color: #676E95\">// 2. set expire key 60 detik</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">await</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">trx</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">execAsync</span><span style=\"color: #F07178\">()</span></span>\n\n<span class=\"line\"><span style=\"color: #89DDFF\">  </span><span style=\"color: #676E95\">// Kirim response yang seharusnya</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #A6ACCD\">res</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">json</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    message</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">Hello world</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\">)</span></span>\n\n<span class=\"line\"><span style=\"color: #676E95\">// Jalankan web app</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">app</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">listen</span><span style=\"color: #A6ACCD\">(port</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #A6ACCD\">console</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">log</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">`</span><span style=\"color: #C3E88D\">App listening on port </span><span style=\"color: #89DDFF\">${</span><span style=\"color: #A6ACCD\">port</span><span style=\"color: #89DDFF\">}</span><span style=\"color: #C3E88D\">!</span><span style=\"color: #89DDFF\">`</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\">)</span></span></code></pre></div>\n</p>\n</details>\n<hr>\n<h4 id=\"6-cobain\"><a href=\"#6-cobain\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>6. Cobain</h4>\n<p>Sampai sini, rate limiting kita sudah jadi.\nSilahkan jalankan kembali perintah <code>node app</code> pada terminal.\nKemudian buka web browser, bukalah URL <code>http://localhost:3000/hello</code>.</p>\n<p>Seharusnya, pada 10 request pertama kamu akan mendapatkan response seperti ini:</p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C792EA\">message</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Hello World</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span></code></pre></div>\n<p>Sedangkan pada request selanjutnya, kamu akan mendapatkan response seperti ini:</p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C792EA\">error</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #F78C6C\">429</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C792EA\">message</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">API rate limit exceeded</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span></code></pre></div>\n<p>Lalu coba tunggu 1 menit, kemudian akses <code>/hello</code> lagi. Responsenya akan kembali seperti ini:</p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C792EA\">message</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Hello World</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span></code></pre></div>\n<p>Artinya rate-limiting kita sudah berhasil membatasi 10 kali akses pada setiap menitnya.</p>\n<h2 id=\"penutup\"><a href=\"#penutup\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Penutup</h2>\n<p>Sampai sini saya harap kamu sudah paham tentang Rate Limiting, serta penerapan Rate Limiting menggunakan Redis (khususnya) pada Express.js. Untuk bahasa dan framework lain, tahapannya kurang/lebih sama.\nYaitu kamu cukup memanfaatkan perintah <code>get</code>, <code>incr</code> dan <code>expire</code> pada Redis client di bahasa/framework itu.</p>\n<p>Sebagai bonus, dibawah ini saya lampirkan kode middleware dari penerapan Rate Limiting kita diatas.\nDengan middleware ini, kamu dapat menerapkan rate-limiting ke berbagai endpoint cukup dengan 1 baris pemanggilan fungsi middleware ini.</p>\n<hr>\n<details><summary>BONUS</summary>\n<p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span><span style=\"color: #A6ACCD\"> format </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">require</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">date-fns</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #A6ACCD\">)</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> express </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">require</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">express</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #A6ACCD\">)</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> bluebird </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">require</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">bluebird</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #A6ACCD\">)</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> redis </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">require</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">redis</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #A6ACCD\">)</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">bluebird</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">promisifyAll</span><span style=\"color: #A6ACCD\">(redis)</span></span>\n\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> client </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> redis</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">createClient</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #F07178\">host</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">127.0.0.1</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">  </span><span style=\"color: #F07178\">port</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #F78C6C\">6379</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\">)</span></span>\n\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> port </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #F78C6C\">3000</span><span style=\"color: #A6ACCD\">     </span><span style=\"color: #676E95\">// definisikan port</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> app </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">express</span><span style=\"color: #A6ACCD\">() </span><span style=\"color: #676E95\">// inisiasi web app</span></span>\n\n<span class=\"line\"><span style=\"color: #676E95\">// Middleware rate limit per menit</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">const</span><span style=\"color: #A6ACCD\"> rateLimitPerMinute </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #A6ACCD\">limit</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> path</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">return</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">async</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #A6ACCD\">req</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">res</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">next</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">time</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">format</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">new</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">Date</span><span style=\"color: #F07178\">()</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">yyyyMMdd:HHmm</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">key</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">`${</span><span style=\"color: #A6ACCD\">req</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #A6ACCD\">ip</span><span style=\"color: #89DDFF\">}</span><span style=\"color: #C3E88D\">:</span><span style=\"color: #89DDFF\">${</span><span style=\"color: #A6ACCD\">path </span><span style=\"color: #89DDFF\">||</span><span style=\"color: #A6ACCD\"> req</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #A6ACCD\">path</span><span style=\"color: #89DDFF\">}</span><span style=\"color: #C3E88D\">:</span><span style=\"color: #89DDFF\">${</span><span style=\"color: #A6ACCD\">time</span><span style=\"color: #89DDFF\">}`</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">count</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #82AAFF\">parseInt</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">await</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">client</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getAsync</span><span style=\"color: #F07178\">(</span><span style=\"color: #A6ACCD\">key</span><span style=\"color: #F07178\">))</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">if</span><span style=\"color: #F07178\"> (</span><span style=\"color: #A6ACCD\">count</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">limit</span><span style=\"color: #F07178\">) </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #89DDFF\">return</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">res</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">status</span><span style=\"color: #F07178\">(</span><span style=\"color: #F78C6C\">429</span><span style=\"color: #F07178\">)</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">json</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">        error</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">429</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">        message</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">`</span><span style=\"color: #C3E88D\">API rate limit exceeded</span><span style=\"color: #89DDFF\">`</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">}</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #C792EA\">const</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">mul</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">client</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">multi</span><span style=\"color: #F07178\">()</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #A6ACCD\">mul</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">incr</span><span style=\"color: #F07178\">(</span><span style=\"color: #A6ACCD\">key</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #A6ACCD\">mul</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">expire</span><span style=\"color: #F07178\">(</span><span style=\"color: #A6ACCD\">key</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">60</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">await</span><span style=\"color: #F07178\"> </span><span style=\"color: #A6ACCD\">mul</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">execAsync</span><span style=\"color: #F07178\">()</span></span>\n\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #82AAFF\">next</span><span style=\"color: #F07178\">()</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">}</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span>\n\n<span class=\"line\"><span style=\"color: #676E95\">// Daftarkan endpoint &quot;GET /hello&quot;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">app</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">/hello</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">rateLimitPerMinute</span><span style=\"color: #A6ACCD\">(</span><span style=\"color: #F78C6C\">10</span><span style=\"color: #A6ACCD\">)</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">async</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #A6ACCD\">req</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> res</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #A6ACCD\">res</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">json</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    message</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">Hello world</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">}</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\">)</span></span>\n\n<span class=\"line\"><span style=\"color: #676E95\">// Jalankan web app</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">app</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">listen</span><span style=\"color: #A6ACCD\">(port</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">()</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">=&gt;</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #A6ACCD\">console</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">log</span><span style=\"color: #F07178\">(</span><span style=\"color: #89DDFF\">`</span><span style=\"color: #C3E88D\">App listening on port </span><span style=\"color: #89DDFF\">${</span><span style=\"color: #A6ACCD\">port</span><span style=\"color: #89DDFF\">}</span><span style=\"color: #C3E88D\">!</span><span style=\"color: #89DDFF\">`</span><span style=\"color: #F07178\">)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span><span style=\"color: #A6ACCD\">)</span></span></code></pre></div>\n</p>\n</details>\n<hr>\n<p>Yaudah sekian dulu artikel kali ini. Semoga bermanfaat. Dadah ~</p>\n","excerpt":"Beberapa waktu yang lalu, saya sempat menuliskan catatan kursus Redis saya di Redis University. Tapi catatannya tidak saya lanjutkan karena materi yang dibahas antar kelas yang satu dengan kelas yang","description":"Membatasi jumlah akses API setiap menitnya menggunakan Redis pada Express.js.","author":{"id":"Muhammad Syifa","title":"Muhammad Syifa","path":"/author/Muhammad%20Syifa/"}}}]}}},"context":{}}