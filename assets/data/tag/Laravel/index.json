{"hash":"1edf71e944044bc70c25b692f010f187723da530","data":{"tag":{"id":"Laravel","title":"Laravel","path":"/tag/Laravel/","belongsTo":{"totalCount":2,"pageInfo":{"totalPages":1,"currentPage":1},"edges":[{"node":{"id":"2b3b2b58bbdb992a1d436929bce29ac4","title":"Ngoding Laravel dengan Gaya, pakai Laravel Evo","datetime":"2021-07-21 11:00:00","path":"/artikel/tentang-laravel-evo/","icon":"/images/icons/evo-icon.png","content":"<p>Beberapa waktu lalu, saya membuat video cara membuat <em>framework</em> kekinian di <a href=\"https://www.youtube.com/channel/UCUDiqWobOUKHKz-KOkn5WYQ\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">kanal youtube saya</a>. Pada <em>framework</em> tersebut, saya menerapkan fitur terbaru pada <em>PHP</em> 8, yaitu <em>attribute</em>.</p>\n<p>Dan tidak lama setelahnya, saya coba menerapkan hal yang sama ke <em>Laravel</em>, dengan membuat <em>package</em> khusus <em>Laravel</em> yang saya beri nama <em>Evo</em>.</p>\n<p>Berikut ini adalah contoh <em>controller</em> saat menggunakan <em>Evo</em> (baris yang di-<em>highlight</em> adalah kode khusus <em>Evo</em>):</p>\n<div class='code-container'><div class=\"code-metadata \" filename=\"TodoController.php\" highlight=\"1,4,5,7-10,18\">TodoController.php</div><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">#[</span><span style=\"color: #FFCB6B\">RoutePrefix</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">todos</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)]</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">class </span><span style=\"color: #FFCB6B\">TodoController</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">#[</span><span style=\"color: #FFCB6B\">Put</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">{id}</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)]</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">#[</span><span style=\"color: #FFCB6B\">Authenticated</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    public function </span><span style=\"color: #82AAFF\">update</span><span style=\"color: #89DDFF\">(</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        #</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #FFCB6B\">Param</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #A6ACCD\"> int </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">id</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        #</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #FFCB6B\">Body</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">UpdateTodoDTO</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">data</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        #</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #FFCB6B\">LoggedUser</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">User</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">user</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">):</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">UpdateTodoResponse</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">todo </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">Todo</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">findOrFail</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #A6ACCD\">id</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">todo</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">title </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">data</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">title</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">todo</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">is_completed </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">data</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">completed</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">todo</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">completed_by </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">data</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">completed </span><span style=\"color: #89DDFF\">?</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">user</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">id </span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> null</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">todo</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">completed_at </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">data</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">completed </span><span style=\"color: #89DDFF\">?</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">date</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Y-m-d H:i:s</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> null</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">todo</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #82AAFF\">save</span><span style=\"color: #89DDFF\">();</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">return</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">UpdateTodoResponse</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">fromArray</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #A6ACCD\">todo</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #82AAFF\">toArray</span><span style=\"color: #89DDFF\">());</span><span style=\"color: #A6ACCD\"> </span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">}</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span></code></pre></div>\n<p>Buat kamu yang pernah mencoba <em>Nest.js</em>, mungkin familiar dengan kode diatas.\nKarena memang saya terinspirasi dari <em>Nest.js</em>.</p>\n<p>Pertanyaannya, untuk apa? gaya-gayaan doang atau ada maksudnya?</p>\n<p>Nah pada artikel ini, saya mau ceritakan manfaat dari penerapan kode seperti di atas.</p>\n<p>Btw, artikel ini saya tujukan orang-orang yang sudah pernah mengembangkan aplikasi dengan <em>Laravel</em>/<em>Lumen</em>. Jadi mungkin untuk yang belum pernah coba <em>framework</em> tersebut, akan sulit untuk memahami maksudnya.</p>\n<h4 id=\"memperjelas-spesifikasi-api-kamu\"><a href=\"#memperjelas-spesifikasi-api-kamu\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Memperjelas Spesifikasi API Kamu</h4>\n<p>Bayangin, kamu baru saja menjadi <em>back-end developer</em> di sebuah perusahaan, dan kamu mendapati kode <em>controller</em> seperti di bawah ini:</p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #C792EA\">public</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">function</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">store</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">Request</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">request</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">invoice </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">Invoice</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">findOrFail</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #A6ACCD\">request</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">invoice_id</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">result</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">invoice</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">invoice</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #82AAFF\">toArray</span><span style=\"color: #89DDFF\">();</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">if</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">($</span><span style=\"color: #A6ACCD\">invoice</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">is_paid</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">throw</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #F78C6C\">new</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">InvoiceAlreadyPaidException</span><span style=\"color: #89DDFF\">();</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">}</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #FFCB6B\">DB</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">beginTransaction</span><span style=\"color: #89DDFF\">();</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">payment </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #F78C6C\">new</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">Payment</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">payment</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">invoice_id </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">invoice</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">id</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">payment</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">method </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">request</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">payment_method</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">payment</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">user_id </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">user</span><span style=\"color: #89DDFF\">()-&gt;</span><span style=\"color: #82AAFF\">id</span><span style=\"color: #89DDFF\">();</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">payment</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">amount </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">request</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">amount</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">if</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">($</span><span style=\"color: #A6ACCD\">request</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">payment_method </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">bank_transfer</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">payment</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">account_number </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">request</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">account_number</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">payment</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">bank_id </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">request</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">bank_id</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">bank </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">Bank</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">findOrFail</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #A6ACCD\">request</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">bank_id</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">result</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">bank_name</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">bank</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">name</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">}</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">payment</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #82AAFF\">save</span><span style=\"color: #89DDFF\">();</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">invoice</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">is_paid </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">true;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">invoice</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #82AAFF\">save</span><span style=\"color: #89DDFF\">();</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #FFCB6B\">DB</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">commit</span><span style=\"color: #89DDFF\">();</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">result </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">array_merge</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #A6ACCD\">result</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">payment</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #82AAFF\">toArray</span><span style=\"color: #89DDFF\">());</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">return</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">response</span><span style=\"color: #89DDFF\">()-&gt;</span><span style=\"color: #82AAFF\">json</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #A6ACCD\">result</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span></code></pre></div>\n<p>Hayo coba tebak, pada kode tersebut inputannya apa aja, dan struktur dari result-nya seperti apa?</p>\n<p>Sulit kan? tentu saja. Karena Programmernya mengambil <em>input</em> dan mengisi <em>result</em> di sembarang tempat, sehingga kita harus jeli melihat setiap baris untuk mengetahui <em>input</em> dan <em>output</em>-nya seperti apa. Itupun ga bisa hanya dilihat dari file itu aja, pada bagian <code>$result['invoice'] = $invoice->toArray()</code>, untuk tahu isi dari data <em>invoice</em>, kita juga harus lihat struktur database pada table <em>invoice</em>. Ribeud.</p>\n<p>Dengan <em>Evo</em>, kita dapat mendefinisikan <em>input</em> dan <em>output</em> langsung pada bagian kepala dari fungsi/<em>method</em>. Sehingga Programmer yang baru gabung, ga perlu membaca logika program hanya untuk tahu inputnya ada apa saja, dan outputnya akan seperti apa.</p>\n<p>Berikut adalah kode diatas, ditulis dengan cara <em>Evo</em>:</p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">#[</span><span style=\"color: #FFCB6B\">Post</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">public function </span><span style=\"color: #82AAFF\">store</span><span style=\"color: #89DDFF\">(</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    #</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #FFCB6B\">Body</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">StorePaymentDTO</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">data</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    #</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #FFCB6B\">LoggedUser</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">User</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">user</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">):</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">StorePaymentResponse</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #676E95\">    // logic program yang kurang lebih sama</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span></code></pre></div>\n<p>Untuk melihat inputan yang tersedia, pada <em>VSCode</em> dengan <em>intelephense</em>, kamu cukup tekan <code>ctrl</code> sambil arahkan cursor ke <code>StorePaymentDTO</code>. Dan kamu akan diperlihatkan <code>class</code> seperti ini, dimana propertinya adalah data dari <em>request body</em>.</p>\n<div class='code-container'><div class=\"code-metadata \" filename=\"StorePaymentDTO.php\">StorePaymentDTO.php</div><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #C792EA\">class</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">StorePaymentDTO</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">extends</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">DTO</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">int</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">invoice_id</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">float</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">amount</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">string</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">payment_method</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">?</span><span style=\"color: #C792EA\">string</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">account_number</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">?</span><span style=\"color: #C792EA\">int</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">bank_id</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span></code></pre></div>\n<p>Begitu pula untuk mengetahui struktur dari <em>output</em>. Cukup arahkan ke <code>StorePaymentResponse</code>, dan kamu akan diperlihatkan <code>class</code> dengan properti seperti ini:</p>\n<div class='code-container'><div class=\"code-metadata \" filename=\"StorePaymentResponse.php\">StorePaymentResponse.php</div><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #C792EA\">class</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">StorePaymentResponse</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">extends</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">JsonResponse</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">int</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">id</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">float</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">amount</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">int</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">user_id</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">string</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">method</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">?</span><span style=\"color: #C792EA\">string</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">account_number</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">?</span><span style=\"color: #C792EA\">int</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">bank_id</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">?</span><span style=\"color: #C792EA\">string</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">bank_name</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">InvoiceDTO</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">invoice</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span></code></pre></div>\n<p>Disana terlihat jelas, isinya apa saja, tipe datanya apa, serta <em>nullable</em> atau tidaknya.</p>\n<h4 id=\"membiasakan-diri-menyiapkan-sesuatu-dan-membuat-tujuan-yang-jelas\"><a href=\"#membiasakan-diri-menyiapkan-sesuatu-dan-membuat-tujuan-yang-jelas\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Membiasakan Diri Menyiapkan Sesuatu dan Membuat Tujuan yang Jelas</h4>\n<p>Programming pada dasarnya hanyalah tentang bagaimana memproses <em>input</em> menjadi <em>output</em>.\n<em>Input</em> adalah apa yang kita miliki, sedangkan <em>output</em> adalah hal yang kita tuju. Melakukan <em>coding</em> tanpa tahu <em>input</em>-nya apa saja, dan <em>output</em>-nya akan seperti apa, sama seperti bepergian tanpa tahu isi tas/dompetmu ada apa saja, dan ga tahu mau kemana, alias luntang-lantung.</p>\n<p>Menulis kode dengan cara <em>Evo</em>, melatih kamu untuk terbiasa mendefinisikan <em>input</em> dan <em>output</em> sebelum menuliskan logika program. Membiasakan kamu menentukan tujuan dan menyiapkan perbekalan sebelum bepergian.</p>\n<h4 id=\"menjaga-keharmonisan-antara-back-end-dengan-mobile-developer\"><a href=\"#menjaga-keharmonisan-antara-back-end-dengan-mobile-developer\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Menjaga Keharmonisan antara Back-end dengan Mobile Developer</h4>\n<p>Kekurangan dari membuat <em>RESTful API</em> dengan bahasa yang menganut <em>dynamic typing</em> seperti <em>PHP</em> atau <em>Javascript</em> adalah seringkali kita khilaf, lupa melakukan <em>casting</em> tipe data. Sedangkan aplikasi <em>mobile</em> biasanya dibuat menggunakan bahasa pemrograman yang <em>static typing</em>, yang mana salah mengirimkan tipe data bisa berakibat fatal. Hal ini seringkali menimbulkan perselisihan antara <em>mobile developer</em> dan <em>back-end developer</em>.</p>\n<p><em>Evo</em> mencegah ini dengan melakukan <em>automatic type casting</em>, dimana setiap <em>request</em> dan <em>response</em> akan otomatis di <em>cast</em> sesuai dengan tipe data yang kita definisikan pada <em>DTO</em> maupun <em>Response class</em>.</p>\n<p>Sebagai contoh, kita diminta membuat <em>response</em> dengan struktur seperti ini:</p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C792EA\">id</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C792EA\">title</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">lorem ipsum dolor sit amet</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C792EA\">is_completed</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">false,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C792EA\">created_at</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">2021-01-02 03:04:05</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span></code></pre></div>\n<p>Pada <em>database</em> <em>MySQL</em>, <em>boolean</em> itu diwakili dengan tipe data <em>integer</em> berisi 0 dan 1, yang kalau kita asal kirim isi dari <em>database</em>, maka <em>mobile developer</em> akan mendapatkan integer <code>0</code> atau <code>1</code>, lebih parahnya lagi malah kadang string <code>\"0\"</code> atau <code>\"1\"</code>.</p>\n<p>Dengan <em>Evo</em>, saat kamu mengirimkan <em>response</em> class seperti di bawah ini.</p>\n<div class='code-container'><div class=\"code-metadata \" filename=\"StoreTodoResponse.php\">StoreTodoResponse.php</div><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #C792EA\">class</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">StoreTodoResponse</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">extends</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">JsonResponse</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">int</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">id</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">string</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">title</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">bool</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">is_completed</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">string</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">created_at</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span></code></pre></div>\n<p><em>Evo</em> akan otomatis melakukan <em>type casting</em>, <code>id</code> menjadi integer, <code>title</code> menjadi string, <code>is_completed</code> menjadi boolean, dan <code>created_at</code> menjadi string.</p>\n<h4 id=\"validasi-otomatis\"><a href=\"#validasi-otomatis\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Validasi Otomatis</h4>\n<p><em>Evo</em> melakukan pengecekan tipe data pada seluruh inputan yang ada di dalam <em>HTTP request</em>, entah itu <code>header</code>-nya, <code>query</code>-nya, <code>parameter</code>-nya, <code>cookie</code>-nya, serta <code>body</code>-nya.</p>\n<p>Contoh, saat kamu menuliskan <code>#[Query] int $page</code>, <em>Evo</em> akan menolak <em>request</em> dengan <em>URL</em> seperti <code>?page=bukan-angka</code>.</p>\n<p>Untuk validasi lebih <em>advance</em>-pun, <em>Evo</em> menyediakan atribut yang dapat kamu gunakan seperti ini:</p>\n<div class='code-container'><div class=\"code-metadata \" filename=\"RegisterDTO.php\" highlight=\"3-4,6-7,9\">RegisterDTO.php</div><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #A6ACCD\">class </span><span style=\"color: #FFCB6B\">RegisterDTO</span><span style=\"color: #A6ACCD\"> extends DTO</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">#[</span><span style=\"color: #FFCB6B\">Email</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #A6ACCD\">message</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Emailnya ga valid wei</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)]</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">#[</span><span style=\"color: #FFCB6B\">Unique</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #A6ACCD\">table</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">users</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> column</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">email</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> message</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Email sudah kepakai bro</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)]</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    public string </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">email</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">#[</span><span style=\"color: #FFCB6B\">Min</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #A6ACCD\">6</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> message</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Password minimal 6 karakter gan</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)]</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">#[</span><span style=\"color: #FFCB6B\">Max</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #A6ACCD\">255</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> message</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Ga sepanjang itu juga jir</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)]</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    public string </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">password</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">#[</span><span style=\"color: #FFCB6B\">Max</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #A6ACCD\">255</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Itu nama atau paragraf masbro</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)]</span><span style=\"color: #A6ACCD\">  </span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    public string </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">name</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span></code></pre></div>\n<p>Disitu kita menuliskan validasi lewat atribut, yang mana lebih ramah untuk <em>Text Editor</em> atau <em>IDE</em>. Jadi kalau kamu lupa parameternya, <em>IDE</em>/<em>Text Editor</em> akan bantu mengingatkan tanpa kamu perlu bolak-balik buka dokumentasi <em>Laravel</em>. Keuntungan ini ga bisa kamu dapatkan dengan penjabaran <em>validation rules</em> via <em>string</em> ala <em>Laravel</em>.</p>\n<h4 id=\"lebih-mudah-dibaca-mesin\"><a href=\"#lebih-mudah-dibaca-mesin\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Lebih Mudah dibaca Mesin</h4>\n<p>Saat menjabarkan <em>input</em> dan <em>output</em> dengan cara <em>Evo</em>, tidak cuma tim kamu yang bisa dengan mudah membaca spesifikasi <em>API</em> kamu. Tapi mesin juga.</p>\n<p>Terus kenapa kalau bisa dibaca mesin?</p>\n<p>Saat mesin bisa memahami keinginan kita, kita bisa menyuruh mesin melakukan sesuatu untuk kita. Saat ini saya sedang membuatkan <em>Swagger generator</em> pada <em>Evo</em>, dimana <em>Evo</em> akan membaca kode kamu dan menampilkan dokumentasi <em>API</em> secara otomatis, tanpa perlu kamu menuliskan <em>OpenAPI</em> secara manual. </p>\n<p>Yap, untuk yang satu ini memang masih tahap pengembangan. Tapi hal ini sangat memungkinkan. Karena <em>Nest.js</em> pun bisa melakukan itu.</p>\n<p>Malah mungkin ga cuma <em>Swagger generator</em>. Tapi juga <em>test generator</em>, jadi <em>Evo</em> akan generate file test serta <em>assertion</em>-nya secara otomatis mengikuti spesifikasi yang kita tuliskan.</p>\n<h2 id=\"penutup\"><a href=\"#penutup\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Penutup</h2>\n<p>Itulah beberapa alasan kenapa saya membuat tools yang memanfaatkan penuh fitur atribut seperti pada <em>Evo</em> ini. Jadi bukan cuma untuk gaya-gayaan ya, banyak juga kok manfaatnya.</p>\n<p>Untuk <em>Evo</em> ini masih saya kembangkan sambil saya gunakan pada <em>side-project</em> saya.\nKalau kamu mau intip-intip pengembangannya bisa mampir ke <a href=\"https://github.com/emsifa/evo\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/emsifa/evo</a>.</p>\n<p>Sekian tulisan kali ini. Dadah ~</p>\n","excerpt":"Beberapa waktu lalu, saya membuat video cara membuat framework kekinian di kanal youtube saya. Pada framework tersebut, saya menerapkan fitur terbaru pada PHP 8, yaitu attribute. Dan tidak lama","description":"Laravel Evo bukan cuma tools untuk mempermudah coding, tapi juga melatih kebiasaan coding yang baik. Kok bisa?","author":{"id":"Muhammad Syifa","title":"Muhammad Syifa","path":"/author/Muhammad%20Syifa/"}}},{"node":{"id":"80040c8d50366162db3f400b81efbfdc","title":"Export Jutaan Data ke CSV dengan Aman di Laravel","datetime":"2019-11-08 11:00:00","path":"/artikel/export-jutaan-data-ke-csv-dengan-aman-di-laravel/","icon":"/images/icons/laravel.png","content":"<p>Pada versi 6.0, Laravel menambahkan sebuah fitur baru yaitu <em>Lazy Collection</em>.\nDengan <em>Lazy Collection</em>, aplikasi Laravel dapat mengambil sekumpulan data dari database\ntanpa harus menampung <strong>seluruh</strong> data tersebut kedalam memori. Di balik layar, <em>Lazy Collection</em>\nmemanfaatkan fitur <em>PHP Generator</em>. Beberapa waktu lalu, saya posting <a href=\"https://www.facebook.com/em.sifa/videos/vb.100000130485713/3270308866316764/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">video</a> untuk menjelaskan bagaimana generator dapat menghemat penggunaan memori,\nvideo berdurasi 20 menitan tersebut dapat membantu kamu untuk lebih memahami apa yang saya tuliskan disini.</p>\n<p>Pada artikel ini, saya mau share bagaimana cara memanfaatkan <em>Lazy Collection</em> untuk melakukan streaming file CSV,\nsehingga kita dapat melakukan export jutaan data tanpa harus menampung jutaan data tersebut ke dalam memori.</p>\n<h4 id=\"kenapa-csv\"><a href=\"#kenapa-csv\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Kenapa CSV?</h4>\n<p>Kenapa menggunakan CSV?, kenapa bukan file excel aja?</p>\n<p>Setahu saya, koreksi kalau salah loh ya. Saat ekspor data menjadi file excel, yang terjadi adalah\n(jutaan) data kamu akan dibuffer/ditampung kedalam konten file excel, setelah selesai,\nfile tersebut masih diolah lagi untuk dilakukan proses encoding,\nstyling (membuat border, warnai teks, merge-cells, dsb), sampai akhirnya <em>buntelan</em> file excel kamu siap,\nbarulah file excel kamu \"disajikan\" ke browser.</p>\n<p>Saat \"memasak\" (baca: mengolah) file excel tersebut, semakin banyak \"porsi\" (baca: baris) yang ingin dimasak, semakin besar pula \"wajan\" (baca: memori) yang harus digunakan untuk \"memasak\" file itu. Kalau \"wajan\"-nya tidak cukup besar, aplikasi kamu akan error, karena memorinya tidak mencukupi.</p>\n<p>Berbeda dengan CSV, file CSV hanya berisi teks biasa (<em>plain text</em>) yang setiap barisnya mewakili baris pada tabel, dimana pada setiap baris terdapat karakter \";\" atau \",\" sebagai pemisah dari masing-masing kolom. Kekurangannya, pada file CSV kita tidak bisa melakukan styling, formula, dsb seperti yang didukung oleh format excel. Tapi dengan kekurangan tersebut, kita dapat melakukan streaming konten CSV baris-per-baris, dari server dialirkan ke browser, dari browser dialirkan ke storage device user. Singkatnya: server kita tidak perlu menampung beban memori dari seluruh data di dalam file CSV yang hendak diekspor.</p>\n<h4 id=\"kenapa-lazy-collection\"><a href=\"#kenapa-lazy-collection\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Kenapa Lazy Collection?</h4>\n<p>Kalau kamu pernah menonton video yang saya sebutkan di awal, kamu akan mengerti peran Lazy Collection disini.\nSingkatnya, dengan Lazy Collection kita tidak perlu menampung data yang ingin kita ekspor,\nsehingga yang terjadi adalah data dari hasil query akan difetch satu-per-satu dari DBMS, untuk kemudian data tersebut\nditulis kedalam stream file CSV yang akan diterima dan diproses langsung oleh web browser.</p>\n<p>Secara keseluruhan, gambaran prosesnya nanti akan jadi (kurang-lebih) seperti ini:</p>\n<p><img src=\"/images/posts/export-jutaan-data-ke-csv-dengan-aman-di-laravel__1.png\" alt=\"Alur download stream csv\"></p>\n<h2 id=\"bagaimana-caranya\"><a href=\"#bagaimana-caranya\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Bagaimana Caranya?</h2>\n<p>Caranya sebetulnya sederhana.\nMisalkan disini kita memiliki model <code>App\\Models\\LogActivity.php</code> yang mewakili table <code>log_activities</code> yang berisi 10 juta data.\nDi dalam table tersebut, kita ingin export data <code>time</code>, <code>user_id</code>, <code>message</code>, <code>ip_address</code>, dan <code>user_agent</code>.</p>\n<p>Supaya agak panjang artikelnya, misalnya isi file modelnya kayak gini:</p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;?</span><span style=\"color: #A6ACCD\">php</span></span>\n\n<span class=\"line\"><span style=\"color: #F78C6C\">namespace</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">Illuminate</span><span style=\"color: #89DDFF\">\\</span><span style=\"color: #FFCB6B\">Database</span><span style=\"color: #89DDFF\">\\</span><span style=\"color: #FFCB6B\">Eloquent</span><span style=\"color: #89DDFF\">\\</span><span style=\"color: #FFCB6B\">Model</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #C792EA\">class</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">LogActivity</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">extends</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">Model</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #C792EA\">protected</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">table </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">log_activities</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span></code></pre></div>\n<p>Dah, gitulah ya.</p>\n<p>Kemudian, kita menambahkan route seperti ini di <code>routes/web.php</code>:</p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">Route</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">get</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">log-activities/export</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">LogActivityController@export</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">);</span></span></code></pre></div>\n<p>Setelah itu, pada controllernya kamu dapat menuliskan seperti ini:</p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;?</span><span style=\"color: #A6ACCD\">php</span></span>\n\n<span class=\"line\"><span style=\"color: #F78C6C\">namespace</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">App</span><span style=\"color: #89DDFF\">\\</span><span style=\"color: #FFCB6B\">Http</span><span style=\"color: #89DDFF\">\\</span><span style=\"color: #FFCB6B\">Controllers</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #F78C6C\">use</span><span style=\"color: #FFCB6B\"> </span><span style=\"color: #A6ACCD\">App</span><span style=\"color: #89DDFF\">\\</span><span style=\"color: #A6ACCD\">Models</span><span style=\"color: #89DDFF\">\\</span><span style=\"color: #A6ACCD\">LogActivity</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">use</span><span style=\"color: #FFCB6B\"> </span><span style=\"color: #A6ACCD\">Illuminate</span><span style=\"color: #89DDFF\">\\</span><span style=\"color: #A6ACCD\">Http</span><span style=\"color: #89DDFF\">\\</span><span style=\"color: #A6ACCD\">Request</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #C792EA\">class</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">LogActivityController</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">extends</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">Controller</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">function</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">export</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">        </span><span style=\"color: #676E95\">// 1. Ambil seluruh data log_activities kedalam LazyCollection (Generator)</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">logs </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">LogActivity</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">orderBy</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">time</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)-&gt;</span><span style=\"color: #82AAFF\">cursor</span><span style=\"color: #89DDFF\">();</span></span>\n\n<span class=\"line\"><span style=\"color: #89DDFF\">        </span><span style=\"color: #676E95\">// FYI: dibawah ini contoh kalau kamu mau gunakan condition dengan cursor</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">        </span><span style=\"color: #676E95\">// $logs = LogActivity::whereRaw(&quot;DATE(time) = &#39;2019-11-08&#39;&quot;)-&gt;where(&#39;user_id&#39;, 1)-&gt;cursor()</span></span>\n\n<span class=\"line\"><span style=\"color: #89DDFF\">        </span><span style=\"color: #676E95\">// 2. Set header untuk streaming file CSV</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">filename </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">log-activities.csv</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #82AAFF\">header</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Content-type: text/csv</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #82AAFF\">header</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Content-Disposition: attachment; filename=</span><span style=\"color: #89DDFF\">{$</span><span style=\"color: #A6ACCD\">filename</span><span style=\"color: #89DDFF\">}&quot;</span><span style=\"color: #89DDFF\">);</span></span>\n\n<span class=\"line\"><span style=\"color: #89DDFF\">        </span><span style=\"color: #676E95\">// 3. Stream file CSV</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">csv </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">fopen</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">php://output</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">w+</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">        </span><span style=\"color: #676E95\">// 3.a. Tulis table header</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #82AAFF\">fputcsv</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #A6ACCD\">csv</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Time</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">User ID</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Message</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">IP Address</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">User Agent</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">]);</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">        </span><span style=\"color: #676E95\">// 3.b. Tulis baris setiap log</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">foreach</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">($</span><span style=\"color: #A6ACCD\">logs </span><span style=\"color: #89DDFF\">as</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">log</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">            </span><span style=\"color: #82AAFF\">fputcsv</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #A6ACCD\">csv</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">[</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">                </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">log</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">time</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">                </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">log</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">user_id</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">                </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">log</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">message</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">                </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">log</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">ip_address</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">                </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">log</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">user_agent</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">            </span><span style=\"color: #89DDFF\">]);</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">}</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">        </span><span style=\"color: #676E95\">// 3.c. Tutup file</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #82AAFF\">fclose</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #A6ACCD\">csv</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">}</span></span>\n\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span></code></pre></div>\n<p>Selesai. Dengan begitu, ketika kamu mengakses <code>https://appkamu.com/log-activities/export</code>,\naplikasi kamu akan mengirimkan response berupa streaming file CSV yang berisi semua data didalam <code>log_activities</code>\ntanpa harus mengalami beban memori yang tinggi.</p>\n<hr>\n<p>Ngomong-ngomong, cara diatas adalah cara yang agak native karena kita langsung menggunakan fungsi <code>header</code> bawaan PHP.\nSaya tulis seperti itu supaya kamu tahu cara di native atau di framework lain seperti apa.\nKalau kamu penasaran cara yang \"lebih\" ke-Laravel-an, kamu dapat menggunakan fungsi <code>streamDownload</code> seperti dibawah ini:</p>\n<div class='code-container'><pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;?</span><span style=\"color: #A6ACCD\">php</span></span>\n\n<span class=\"line\"><span style=\"color: #F78C6C\">namespace</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">App</span><span style=\"color: #89DDFF\">\\</span><span style=\"color: #FFCB6B\">Http</span><span style=\"color: #89DDFF\">\\</span><span style=\"color: #FFCB6B\">Controllers</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #F78C6C\">use</span><span style=\"color: #FFCB6B\"> </span><span style=\"color: #A6ACCD\">App</span><span style=\"color: #89DDFF\">\\</span><span style=\"color: #A6ACCD\">Models</span><span style=\"color: #89DDFF\">\\</span><span style=\"color: #A6ACCD\">LogActivity</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">use</span><span style=\"color: #FFCB6B\"> </span><span style=\"color: #A6ACCD\">Illuminate</span><span style=\"color: #89DDFF\">\\</span><span style=\"color: #A6ACCD\">Http</span><span style=\"color: #89DDFF\">\\</span><span style=\"color: #A6ACCD\">Request</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #C792EA\">class</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">LogActivityController</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">extends</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">Controller</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">{</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #C792EA\">public</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #C792EA\">function</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">export</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">logs </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #FFCB6B\">LogActivity</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">orderBy</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">time</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)-&gt;</span><span style=\"color: #82AAFF\">cursor</span><span style=\"color: #89DDFF\">();</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">filename </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">log-activities.csv</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">;</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">return</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">response</span><span style=\"color: #89DDFF\">()-&gt;</span><span style=\"color: #82AAFF\">streamDownload</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">function</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #F78C6C\">use</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">($</span><span style=\"color: #A6ACCD\">logs</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">            </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">csv </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #82AAFF\">fopen</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">php://output</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">w+</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">);</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">            </span><span style=\"color: #82AAFF\">fputcsv</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #A6ACCD\">csv</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Time</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">User ID</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Message</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">IP Address</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">User Agent</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">]);</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">            </span><span style=\"color: #89DDFF\">foreach</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">($</span><span style=\"color: #A6ACCD\">logs </span><span style=\"color: #89DDFF\">as</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">log</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">{</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">                </span><span style=\"color: #82AAFF\">fputcsv</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #A6ACCD\">csv</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">[</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">                    </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">log</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">time</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">                    </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">log</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">user_id</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">                    </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">log</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">message</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">                    </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">log</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">ip_address</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">                    </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">log</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #A6ACCD\">user_agent</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">                </span><span style=\"color: #89DDFF\">]);</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">            </span><span style=\"color: #89DDFF\">}</span></span>\n\n<span class=\"line\"><span style=\"color: #A6ACCD\">            </span><span style=\"color: #82AAFF\">fclose</span><span style=\"color: #89DDFF\">($</span><span style=\"color: #A6ACCD\">csv</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">        </span><span style=\"color: #89DDFF\">},</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">$</span><span style=\"color: #A6ACCD\">filename</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Content-type</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">=&gt;</span><span style=\"color: #A6ACCD\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">text/csv</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">]);</span></span>\n<span class=\"line\"><span style=\"color: #A6ACCD\">    </span><span style=\"color: #89DDFF\">}</span></span>\n\n<span class=\"line\"><span style=\"color: #89DDFF\">}</span></span></code></pre></div>\n<hr>\n<p>Seperti itulah cara melakukan export CSV secara aman di Laravel. Kalau ada saran, masukan, atau pertanyaan, silahkan kontak facebook saya.\nAkhir kata, semoga bermanfaat.</p>\n","excerpt":"Pada versi 6.0, Laravel menambahkan sebuah fitur baru yaitu Lazy Collection. Dengan Lazy Collection, aplikasi Laravel dapat mengambil sekumpulan data dari database tanpa harus menampung seluruh data","description":"Bagaimana memanfaatkan generator dan streaming CSV untuk export jutaan data secara aman.","author":{"id":"Muhammad Syifa","title":"Muhammad Syifa","path":"/author/Muhammad%20Syifa/"}}}]}}},"context":{}}